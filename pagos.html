<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Pasarela de Pago - LatinPhone</title>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Lottie Animation -->
    <script src="https://unpkg.com/@lottiefiles/lottie-player@latest/dist/lottie-player.js" defer></script>
    
    <!-- Confetti JS -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js" defer></script>
    
    <style>
        :root {
            --primary-color: #0071e3;
            --primary-hover: #0062c3;
            --primary-light: #e9f3ff;
            --primary-gradient: linear-gradient(135deg, #0071e3, #4e9fff);
            --secondary-color: #1d1d1f;
            --accent-color: #86868b;
            --success-color: #4cd964;
            --success-gradient: linear-gradient(135deg, #4cd964, #34c759);
            --error-color: #ff3b30;
            --warning-color: #ffcc00;
            --background-color: #ffffff;
            --background-alt: #f5f7fa;
            --background-gradient: linear-gradient(135deg, #f5f7fa, #ffffff);
            --light-gray: #f5f5f7;
            --medium-gray: #d2d2d7;
            --border-color: #d2d2d7;
            --white: #ffffff;
            --black: #000000;
            --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.05);
            --shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            --shadow-lg: 0 8px 30px rgba(0, 0, 0, 0.1);
            --shadow-color: rgba(0, 0, 0, 0.15);
            --transition-fast: 0.2s ease;
            --transition: 0.3s ease;
            --transition-slow: 0.5s ease;
            --radius-sm: 8px;
            --radius: 14px;
            --radius-lg: 24px;
            --radius-xl: 32px;
            --radius-full: 9999px;
            --header-height: 70px;
            --z-header: 1000;
            --z-overlay: 1001;
            --z-dropdown: 1002;
            --z-modal: 1003;
            --z-toast: 1004;
            --max-width: 1280px;
            --font-main: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
        }

        *, *::before, *::after {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        html {
            scroll-behavior: smooth;
            font-size: 62.5%;
            scroll-padding-top: var(--header-height);
            height: 100%;
        }

        body {
            font-family: var(--font-main);
            font-size: 1.6rem;
            line-height: 1.6;
            color: var(--secondary-color);
            background-color: var(--background-color);
            min-height: 100vh;
            padding-top: var(--header-height);
            overflow-x: hidden;
            position: relative;
            height: 100%;
        }

        .container {
            max-width: var(--max-width);
            margin: 0 auto;
            padding: 0 2rem;
            width: 100%;
        }

        .checkout-container {
            max-width: 120rem;
            margin: 0 auto;
            padding: 3rem 2rem 5rem;
            width: 100%;
        }

        /* Estilos para la cabecera de la página de pago */
        .checkout-header {
            text-align: center;
            margin-bottom: 4rem;
            position: relative;
            padding: 5rem 2rem 3rem;
            background-image: url('https://www.honor.com/content/dam/honor/global/honor-esg/esg-report-2023/section-youth/img-bg-pc.webp');
            background-size: cover;
            background-position: center;
            border-radius: var(--radius-lg);
            overflow: hidden;
            color: var(--white);
        }

        .checkout-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 0;
        }

        .checkout-header * {
            position: relative;
            z-index: 1;
        }

        .checkout-header::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 15rem;
            height: 4px;
            background: var(--primary-gradient);
            border-radius: var(--radius-full);
            z-index: 1;
        }

        .checkout-logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .checkout-logo-text {
            font-size: 3.2rem;
            font-weight: 700;
            color: var(--white);
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .checkout-title {
            font-size: 3.6rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
            color: var(--white);
            text-shadow: 0 2px 8px rgba(0, 0, 0, 0.4);
            line-height: 1.2;
        }

        .checkout-subtitle {
            font-size: 1.8rem;
            color: var(--white);
            max-width: 60rem;
            margin: 0 auto;
            line-height: 1.5;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        /* Pasos de compra mejorados */
        .checkout-steps {
            display: flex;
            justify-content: center;
            margin-bottom: 5rem;
            position: relative;
            overflow: visible;
            padding: 0 1rem;
        }

        .checkout-steps::before {
            content: '';
            position: absolute;
            top: 2.5rem;
            left: 17%;
            width: 66%;
            height: 2px;
            background-color: var(--medium-gray);
            z-index: 0;
        }

        .checkout-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 20%;
            position: relative;
            z-index: 1;
        }

        .step-number {
            width: 5rem;
            height: 5rem;
            border-radius: 50%;
            background-color: var(--light-gray);
            color: var(--accent-color);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 2rem;
            margin-bottom: 1.5rem;
            transition: var(--transition);
            box-shadow: var(--shadow-sm);
            position: relative;
            overflow: hidden;
        }

        .step-number::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--primary-gradient);
            opacity: 0;
            transition: var(--transition);
        }

        .step-icon {
            position: relative;
            z-index: 2;
        }

        .step-text {
            font-size: 1.4rem;
            text-align: center;
            color: var(--accent-color);
            transition: var(--transition);
            font-weight: 500;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 100%;
            padding: 0 0.5rem;
        }

        .checkout-step.active .step-number {
            transform: scale(1.1);
            box-shadow: 0 0 0 4px rgba(0, 113, 227, 0.2);
        }

        .checkout-step.active .step-number::before {
            opacity: 1;
        }

        .checkout-step.active .step-icon {
            color: var(--white);
        }

        .checkout-step.active .step-text {
            color: var(--primary-color);
            font-weight: 600;
        }

        .checkout-step.completed .step-number {
            background-color: var(--success-color);
            color: var(--white);
        }

        .checkout-step.completed .step-number::before {
            background: var(--success-gradient);
            opacity: 1;
        }

        .checkout-step.completed .step-icon {
            color: var(--white);
        }

        /* Checkout Content */
        .checkout-content {
            margin-bottom: 5rem;
            min-height: 40rem;
            position: relative;
        }

        .checkout-section {
            display: none;
            opacity: 0;
            transform: translateY(2rem);
        }

        .checkout-section.active {
            display: block;
            animation: fadeIn 0.5s ease forwards;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(2rem);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .section-title {
            font-size: 2.4rem;
            font-weight: 600;
            margin-bottom: 3rem;
            position: relative;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            gap: 1rem;
            line-height: 1.3;
        }

        .section-title i {
            color: var(--primary-color);
            font-size: 2.2rem;
            flex-shrink: 0;
        }

        /* Featured Products Section */
        .featured-product {
            position: relative;
            margin: 3rem 0 5rem;
            border-radius: var(--radius-lg);
            overflow: hidden;
            box-shadow: var(--shadow-lg);
            max-height: 60rem;
        }

        .featured-video {
            width: 100%;
            display: block;
            object-fit: cover;
        }

        .featured-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            padding: 3rem 2rem;
            background: linear-gradient(to top, rgba(0,0,0,0.8), transparent);
            color: var(--white);
            text-align: center;
        }

        .featured-overlay h3 {
            font-size: 2.8rem;
            font-weight: 700;
            margin-bottom: 1rem;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
        }

        .featured-overlay p {
            font-size: 1.8rem;
            margin-bottom: 2rem;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
            max-width: 60rem;
            margin-left: auto;
            margin-right: auto;
        }

        /* Sección de país mejorada */
        .country-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(14rem, 1fr));
            gap: 1.5rem;
            margin-bottom: 4rem;
        }

        .country-card {
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            padding: 1.5rem;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            background-color: var(--white);
            box-shadow: var(--shadow-sm);
            position: relative;
            overflow: hidden;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .country-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--primary-light);
            opacity: 0;
            transition: var(--transition);
            z-index: 0;
        }

        .country-card:hover {
            transform: translateY(-0.8rem);
            border-color: var(--primary-color);
            box-shadow: var(--shadow);
        }

        .country-card:hover::before {
            opacity: 0.3;
        }

        .country-card.selected {
            border-color: var(--primary-color);
            background-color: var(--primary-light);
            box-shadow: var(--shadow);
            transform: translateY(-0.5rem) scale(1.02);
        }

        .country-card.selected::before {
            opacity: 0.5;
        }

        .country-card.selected::after {
            content: '\f00c';
            font-family: 'Font Awesome 6 Free';
            font-weight: 900;
            position: absolute;
            top: 1rem;
            right: 1rem;
            color: var(--primary-color);
            font-size: 1.4rem;
            z-index: 2;
        }

        .country-flag {
            font-size: 5rem;
            margin-bottom: 1.5rem;
            position: relative;
            z-index: 1;
            transition: var(--transition);
        }

        .country-card:hover .country-flag,
        .country-card.selected .country-flag {
            transform: scale(1.1);
        }

        .country-name {
            font-size: 1.4rem;
            font-weight: 500;
            position: relative;
            z-index: 1;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 100%;
            padding: 0 0.5rem;
        }

        /* Categoría, marca y producto mejorados */
        .category-grid,
        .brand-grid,
        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(19rem, 1fr));
            gap: 2rem;
            margin-bottom: 3rem;
        }

        .category-card,
        .brand-card {
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            overflow: hidden;
            cursor: pointer;
            transition: var(--transition);
            background-color: var(--white);
            box-shadow: var(--shadow-sm);
            position: relative;
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .category-card::after,
        .brand-card::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 0.4rem;
            background: var(--primary-gradient);
            transform: scaleX(0);
            transform-origin: center;
            transition: var(--transition);
        }

        .category-card:hover,
        .brand-card:hover {
            transform: translateY(-0.8rem);
            box-shadow: var(--shadow);
            border-color: var(--primary-color);
        }

        .category-card:hover::after,
        .brand-card:hover::after {
            transform: scaleX(1);
        }

        .category-card.selected,
        .brand-card.selected {
            border-color: var(--primary-color);
            box-shadow: var(--shadow);
            transform: translateY(-0.5rem);
        }

        .category-card.selected::after,
        .brand-card.selected::after {
            transform: scaleX(1);
        }

        .category-icon,
        .brand-icon {
            width: 100%;
            height: 14rem;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: var(--light-gray);
            padding: 2rem;
            transition: var(--transition);
            font-size: 5rem;
            color: var(--primary-color);
        }

        .brand-icon {
            height: 12rem;
            font-size: 4rem;
            text-transform: uppercase;
            font-weight: 700;
            letter-spacing: 1px;
        }

        .category-info,
        .brand-info {
            padding: 1.8rem;
            text-align: center;
            background-color: var(--white);
            position: relative;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .category-name,
        .brand-name {
            font-size: 1.6rem;
            font-weight: 500;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* Product List mejorado */
        .product-card {
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            overflow: hidden;
            transition: var(--transition);
            height: 100%;
            display: flex;
            flex-direction: column;
            background-color: var(--white);
            box-shadow: var(--shadow-sm);
            position: relative;
        }

        .product-card:hover {
            transform: translateY(-0.8rem);
            box-shadow: var(--shadow);
            border-color: var(--primary-color);
        }

        .product-media-container {
            position: relative;
            width: 100%;
            height: 18rem;
            background-color: var(--light-gray);
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .product-icon {
            font-size: 7rem;
            color: var(--primary-color);
        }

        .product-video-btn {
            position: absolute;
            bottom: 1rem;
            right: 1rem;
            width: 3.6rem;
            height: 3.6rem;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(5px);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary-color);
            font-size: 1.6rem;
            border: none;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
            z-index: 3;
        }

        .product-video-btn:hover {
            background-color: var(--white);
            transform: scale(1.1);
        }

        .product-info {
            padding: 2rem;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            border-top: 1px solid var(--border-color);
        }

        .product-brand {
            font-size: 1.2rem;
            color: var(--primary-color);
            font-weight: 500;
            margin-bottom: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .product-name {
            font-size: 1.6rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--secondary-color);
            line-height: 1.3;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            text-overflow: ellipsis;
            height: 4.2rem;
        }

        .product-specs {
            display: flex;
            flex-wrap: wrap;
            gap: 0.8rem;
            margin-bottom: 1.5rem;
        }

        .product-specs span {
            display: inline-block;
            background-color: var(--light-gray);
            padding: 0.4rem 1rem;
            border-radius: var(--radius-full);
            font-size: 1.2rem;
            color: var(--accent-color);
            font-weight: 500;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 100%;
        }

        .product-price {
            font-size: 2.2rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-top: auto;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
        }

        .product-price::before {
            content: 'USD';
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--accent-color);
            margin-right: 0.5rem;
        }

        .product-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 1rem;
        }

        .quantity-control {
            display: flex;
            align-items: center;
            border: 1px solid var(--border-color);
            border-radius: var(--radius-full);
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            flex-shrink: 0;
        }

        .quantity-btn {
            width: 3.2rem;
            height: 3.2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: var(--light-gray);
            border: none;
            font-size: 1.4rem;
            cursor: pointer;
            transition: var(--transition-fast);
            color: var(--accent-color);
            touch-action: manipulation;
        }

        .quantity-btn:hover {
            background-color: var(--medium-gray);
            color: var(--secondary-color);
        }

        .quantity-input {
            width: 4rem;
            height: 3.2rem;
            border: none;
            text-align: center;
            font-size: 1.4rem;
            font-weight: 500;
            color: var(--secondary-color);
            background-color: var(--white);
            -moz-appearance: textfield;
        }

        .quantity-input::-webkit-outer-spin-button,
        .quantity-input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        .quantity-input:focus {
            outline: none;
        }

        .add-to-cart-btn {
            padding: 0 1.8rem;
            height: 3.2rem;
            background-color: var(--primary-color);
            color: var(--white);
            border: none;
            border-radius: var(--radius-full);
            font-weight: 500;
            font-size: 1.4rem;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 0.8rem;
            flex-grow: 1;
            justify-content: center;
            white-space: nowrap;
            touch-action: manipulation;
        }

        .add-to-cart-btn i {
            font-size: 1.2rem;
        }

        .add-to-cart-btn:hover {
            background-color: var(--primary-hover);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 113, 227, 0.3);
        }

        .add-to-cart-btn:active {
            transform: translateY(0);
            box-shadow: none;
        }

        /* Video Modal */
        .video-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: var(--z-modal);
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
        }

        .video-modal.active {
            opacity: 1;
            visibility: visible;
        }

        .video-container {
            width: 90%;
            max-width: 80rem;
            position: relative;
            border-radius: var(--radius);
            overflow: hidden;
            box-shadow: var(--shadow-lg);
            transform: scale(0.9);
            transition: var(--transition);
        }

        .video-modal.active .video-container {
            transform: scale(1);
        }

        .video-player {
            width: 100%;
            display: block;
            aspect-ratio: 16/9;
        }

        .close-video {
            position: absolute;
            top: 1.5rem;
            right: 1.5rem;
            width: 4rem;
            height: 4rem;
            border-radius: 50%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--white);
            font-size: 1.8rem;
            border: none;
            cursor: pointer;
            transition: var(--transition);
            z-index: 5;
            touch-action: manipulation;
        }

        .close-video:hover {
            background-color: rgba(0, 0, 0, 0.8);
            transform: scale(1.1);
        }

        /* Cart Summary Section mejorado */
        .checkout-grid {
            display: grid;
            grid-template-columns: 1fr 38rem;
            gap: 3rem;
        }

        .cart-items {
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            overflow: hidden;
            background-color: var(--white);
            box-shadow: var(--shadow-sm);
        }

        .cart-header {
            padding: 1.5rem 2rem;
            background-color: var(--light-gray);
            font-weight: 600;
            display: grid;
            grid-template-columns: 1fr 10rem 15rem 10rem;
            gap: 1rem;
            align-items: center;
            border-bottom: 1px solid var(--border-color);
        }

        .cart-item {
            padding: 2rem;
            border-bottom: 1px solid var(--border-color);
            display: grid;
            grid-template-columns: 1fr 10rem 15rem 10rem;
            gap: 1rem;
            align-items: center;
            transition: var(--transition);
        }

        .cart-item:last-child {
            border-bottom: none;
        }

        .cart-item:hover {
            background-color: var(--primary-light);
        }

        .item-details {
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }

        .item-image-container {
            width: 8rem;
            height: 8rem;
            border-radius: var(--radius-sm);
            background-color: var(--light-gray);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0.5rem;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            transition: var(--transition);
            flex-shrink: 0;
        }

        .item-icon {
            font-size: 4rem;
            color: var(--primary-color);
        }

        .cart-item:hover .item-image-container {
            transform: scale(1.05);
        }

        .item-info {
            flex-grow: 1;
            min-width: 0;
        }

        .item-info h4 {
            font-size: 1.6rem;
            margin-bottom: 0.5rem;
            color: var(--secondary-color);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            line-height: 1.3;
        }

        .item-specs {
            font-size: 1.2rem;
            color: var(--accent-color);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .item-price, 
        .item-subtotal {
            font-weight: 500;
            color: var(--secondary-color);
            text-align: center;
        }

        .item-subtotal {
            color: var(--primary-color);
            font-weight: 600;
            text-align: right;
        }

        .item-quantity {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .item-actions {
            display: flex;
            justify-content: flex-end;
        }

        .remove-item {
            color: var(--error-color);
            cursor: pointer;
            font-size: 1.4rem;
            transition: var(--transition);
            width: 3.2rem;
            height: 3.2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            touch-action: manipulation;
        }

        .remove-item:hover {
            background-color: rgba(255, 59, 48, 0.1);
            transform: scale(1.1);
        }

        .cart-empty {
            padding: 5rem 2rem;
            text-align: center;
        }

        .cart-empty i {
            font-size: 5rem;
            color: var(--medium-gray);
            margin-bottom: 2rem;
        }

        .cart-empty p {
            font-size: 1.8rem;
            margin-bottom: 2rem;
            color: var(--accent-color);
        }

        /* Order Summary mejorado */
        .order-summary {
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            overflow: hidden;
            position: sticky;
            top: calc(var(--header-height) + 2rem);
            background-color: var(--white);
            box-shadow: var(--shadow);
            align-self: flex-start;
        }

        .summary-header {
            padding: 1.8rem 2rem;
            background: var(--primary-gradient);
            font-size: 1.8rem;
            font-weight: 600;
            color: var(--white);
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .summary-header i {
            font-size: 1.8rem;
        }

        .summary-content {
            padding: 2rem;
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 1.5rem;
            font-size: 1.5rem;
        }

        .summary-row span:first-child {
            color: var(--accent-color);
        }

        .summary-row.total {
            font-size: 1.8rem;
            font-weight: 600;
            padding-top: 1.5rem;
            margin-top: 1.5rem;
            border-top: 2px solid var(--border-color);
            color: var(--secondary-color);
        }

        .exchange-rate-info {
            font-size: 1.4rem;
            background-color: var(--primary-light);
            border-radius: var(--radius-sm);
            padding: 1rem;
            margin-bottom: 1.5rem;
            color: var(--primary-color);
            text-align: center;
            font-weight: 500;
        }

        .bs-price {
            color: var(--accent-color);
            font-size: 1.4rem;
            font-weight: normal;
            margin-top: 0.5rem;
        }

        .checkout-actions {
            margin-top: 3rem;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 1.4rem 2.4rem;
            border-radius: var(--radius-full);
            font-weight: 500;
            font-size: 1.6rem;
            transition: var(--transition);
            border: none;
            outline: none;
            cursor: pointer;
            white-space: nowrap;
            box-shadow: var(--shadow-sm);
            position: relative;
            overflow: hidden;
            touch-action: manipulation;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.2);
            transition: var(--transition);
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn-icon {
            margin-right: 1rem;
            font-size: 1.8rem;
            flex-shrink: 0;
        }

        .btn-primary {
            background: var(--primary-gradient);
            color: var(--white);
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, #0062c3, #0071e3);
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 113, 227, 0.3);
        }

        .btn-primary:active {
            transform: translateY(0);
            box-shadow: var(--shadow-sm);
        }

        .btn-secondary {
            background-color: var(--light-gray);
            color: var(--secondary-color);
        }

        .btn-secondary:hover {
            background-color: var(--medium-gray);
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .btn-secondary:active {
            transform: translateY(0);
            box-shadow: var(--shadow-sm);
        }

        .btn-block {
            display: flex;
            width: 100%;
        }

        .btn:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            transform: none !important;
            box-shadow: var(--shadow-sm) !important;
        }

        /* Sección de regalo y opciones de envío mejoradas */
        .gift-section-header {
            display: flex;
            align-items: center;
            margin-bottom: 3rem;
        }

        .gift-icon {
            width: 6rem;
            height: 6rem;
            background-color: var(--primary-light);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.8rem;
            color: var(--primary-color);
            margin-right: 2rem;
            flex-shrink: 0;
        }

        .gift-info h3 {
            font-size: 2rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--secondary-color);
            line-height: 1.3;
        }

        .gift-info p {
            font-size: 1.5rem;
            color: var(--accent-color);
            line-height: 1.5;
        }

        .gift-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(18rem, 1fr));
            gap: 2rem;
            margin-bottom: 4rem;
        }

        .gift-card {
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            overflow: hidden;
            cursor: pointer;
            transition: var(--transition);
            background-color: var(--white);
            box-shadow: var(--shadow-sm);
            height: 100%;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        .gift-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 0.4rem;
            background: linear-gradient(to right, #ff3b30, #ffcc00);
            opacity: 0;
            transition: var(--transition);
        }

        .gift-card:hover {
            transform: translateY(-0.8rem);
            box-shadow: var(--shadow);
            border-color: #ffcc00;
        }

        .gift-card:hover::before {
            opacity: 1;
        }

        .gift-card.selected {
            border-color: #ffcc00;
            box-shadow: 0 5px 20px rgba(255, 204, 0, 0.3);
            transform: translateY(-0.5rem);
        }

        .gift-card.selected::before {
            opacity: 1;
        }

        .gift-card.selected::after {
            content: '\f06b';
            font-family: 'Font Awesome 6 Free';
            font-weight: 900;
            position: absolute;
            top: 1rem;
            right: 1rem;
            color: #ffcc00;
            font-size: 2rem;
            z-index: 3;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.2));
        }

        .gift-icon-display {
            width: 100%;
            height: 16rem;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: var(--light-gray);
            padding: 2rem;
            transition: var(--transition);
            font-size: 6rem;
            color: #ffcc00;
        }

        .gift-card:hover .gift-icon-display {
            transform: scale(1.05);
        }

        .gift-info-card {
            padding: 1.8rem;
            text-align: center;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .gift-name {
            font-size: 1.6rem;
            font-weight: 600;
            margin-bottom: 0.8rem;
            color: var(--secondary-color);
            line-height: 1.3;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            height: 4.2rem;
        }

        .gift-free {
            display: inline-block;
            background-color: #ffcc00;
            color: var(--white);
            padding: 0.4rem 1.2rem;
            border-radius: var(--radius-full);
            font-size: 1.2rem;
            font-weight: 600;
            margin-top: 1rem;
        }

        /* Opciones de envío mejoradas */
        .shipping-options {
            margin-bottom: 4rem;
        }

        .shipping-option {
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            padding: 2rem;
            display: flex;
            align-items: center;
            gap: 2rem;
            margin-bottom: 2rem;
            cursor: pointer;
            transition: var(--transition);
            background-color: var(--white);
            box-shadow: var(--shadow-sm);
            position: relative;
            overflow: hidden;
        }

        .shipping-option::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 0.4rem;
            height: 100%;
            background: var(--primary-gradient);
            opacity: 0;
            transition: var(--transition);
        }

        .shipping-option:hover {
            transform: translateY(-0.5rem);
            box-shadow: var(--shadow);
        }

        .shipping-option:hover::before {
            opacity: 1;
        }

        .shipping-option.selected {
            border-color: var(--primary-color);
            background-color: var(--primary-light);
            box-shadow: var(--shadow);
            padding-left: 2.4rem;
        }

        .shipping-option.selected::before {
            opacity: 1;
        }

        .shipping-radio {
            width: 2.4rem;
            height: 2.4rem;
            border-radius: 50%;
            border: 2px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            transition: var(--transition);
            background-color: var(--white);
        }

        .shipping-option:hover .shipping-radio {
            border-color: var(--primary-color);
        }

        .shipping-option.selected .shipping-radio {
            border-color: var(--primary-color);
            border-width: 6px;
            background-color: var(--white);
        }

        .shipping-info {
            flex-grow: 1;
            min-width: 0;
        }

        .shipping-title {
            font-size: 1.8rem;
            font-weight: 600;
            margin-bottom: 0.8rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            color: var(--secondary-color);
            line-height: 1.3;
            flex-wrap: wrap;
        }

        .shipping-description {
            font-size: 1.4rem;
            color: var(--accent-color);
            line-height: 1.4;
        }

        .shipping-price {
            font-size: 2rem;
            font-weight: 700;
            flex-shrink: 0;
            color: var(--primary-color);
            white-space: nowrap;
        }

        .shipping-option.selected .shipping-price {
            color: var(--primary-color);
        }

        /* Mejoras para compañías de envío */
        .shipping-dropdown {
            position: relative;
            max-width: 40rem;
            width: 100%;
            margin-bottom: 3rem;
        }

        .shipping-dropdown-btn {
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1.5rem 2rem;
            background-color: var(--white);
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            font-size: 1.6rem;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: var(--shadow-sm);
        }

        .shipping-dropdown-btn:hover {
            border-color: var(--primary-color);
            box-shadow: var(--shadow);
        }

        .shipping-dropdown-menu {
            position: absolute;
            top: calc(100% + 0.5rem);
            left: 0;
            width: 100%;
            background-color: var(--white);
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            box-shadow: var(--shadow-lg);
            z-index: 100;
            max-height: 30rem;
            overflow-y: auto;
            display: none;
        }

        .shipping-dropdown-menu.active {
            display: block;
        }

        .shipping-company-option {
            padding: 1.2rem 2rem;
            cursor: pointer;
            transition: var(--transition-fast);
        }

        .shipping-company-option:hover {
            background-color: var(--primary-light);
        }

        .shipping-company-option.selected {
            background-color: var(--primary-light);
            font-weight: 600;
        }

        .shipping-company-text {
            font-size: 1.6rem;
        }

        /* Seguro del equipo mejorado */
        .insurance-option {
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            padding: 2.5rem;
            margin-bottom: 2rem;
            display: flex;
            align-items: center;
            gap: 2rem;
            cursor: pointer;
            transition: var(--transition);
            background-color: var(--white);
            box-shadow: var(--shadow-sm);
            position: relative;
            overflow: hidden;
        }

        .insurance-option::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 0.4rem;
            height: 100%;
            background: var(--primary-gradient);
            opacity: 0;
            transition: var(--transition);
        }

        .insurance-option.premium::before {
            background: linear-gradient(to bottom, #4cd964, #34c759);
        }

        .insurance-option:hover {
            transform: translateY(-0.5rem);
            box-shadow: var(--shadow);
        }

        .insurance-option:hover::before {
            opacity: 1;
        }

        .insurance-option.selected {
            border-color: var(--primary-color);
            box-shadow: var(--shadow);
            padding-left: 2.9rem;
        }

        .insurance-option.premium.selected {
            border-color: #4cd964;
            background-color: rgba(76, 217, 100, 0.1);
        }

        .insurance-option.selected::before {
            opacity: 1;
        }

        .insurance-info {
            flex-grow: 1;
            min-width: 0;
        }

        .insurance-title {
            font-size: 1.8rem;
            font-weight: 600;
            margin-bottom: 0.8rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            color: var(--secondary-color);
            line-height: 1.3;
        }

        .insurance-description {
            font-size: 1.4rem;
            color: var(--accent-color);
            line-height: 1.4;
        }

        .insurance-price {
            font-size: 2rem;
            font-weight: 700;
            flex-shrink: 0;
            color: var(--primary-color);
            white-space: nowrap;
        }

        .insurance-option.premium .insurance-price {
            color: #4cd964;
        }

        /* Notificación de tasas mejorada */
        .tax-notification {
            background-color: var(--primary-light);
            border-left: 4px solid var(--warning-color);
            padding: 2.5rem;
            border-radius: var(--radius);
            margin: 3rem 0;
            box-shadow: var(--shadow-sm);
            position: relative;
            overflow: hidden;
        }

        .tax-notification::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(255, 204, 0, 0.1), transparent);
            z-index: 0;
        }

        .tax-notification h4 {
            font-size: 1.8rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            position: relative;
            z-index: 1;
            color: var(--secondary-color);
            line-height: 1.3;
        }

        .tax-notification h4 i {
            color: var(--warning-color);
            font-size: 2rem;
            flex-shrink: 0;
        }

        .tax-notification p {
            font-size: 1.5rem;
            color: var(--accent-color);
            margin-bottom: 1.5rem;
            position: relative;
            z-index: 1;
            line-height: 1.5;
        }

        .tax-checkbox {
            display: flex;
            align-items: flex-start;
            gap: 1.5rem;
            position: relative;
            z-index: 1;
        }

        .tax-checkbox input {
            width: 2rem;
            height: 2rem;
            accent-color: var(--primary-color);
            cursor: pointer;
            margin-top: 0.2rem;
        }

        .tax-checkbox label {
            font-size: 1.6rem;
            font-weight: 500;
            color: var(--secondary-color);
            cursor: pointer;
            line-height: 1.4;
        }

        /* Payment Methods Section mejorado */
        .payment-methods {
            margin-bottom: 4rem;
        }

        .payment-options {
            display: flex;
            flex-wrap: wrap;
            gap: 2rem;
            margin-bottom: 3rem;
        }

        .payment-option {
            width: 14rem;
            height: 8rem;
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            background-color: var(--white);
            box-shadow: var(--shadow-sm);
            position: relative;
            overflow: hidden;
            flex-direction: column;
            gap: 1rem;
        }

        .payment-option::before {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 0.4rem;
            background: var(--primary-gradient);
            transform: scaleX(0);
            transition: var(--transition);
        }

        .payment-option:hover {
            transform: translateY(-0.5rem);
            box-shadow: var(--shadow);
            border-color: var(--border-color);
        }

        .payment-option:hover::before {
            transform: scaleX(1);
        }

        .payment-option.selected {
            border-color: var(--primary-color);
            background-color: var(--primary-light);
            box-shadow: var(--shadow);
        }

        .payment-option.selected::before {
            transform: scaleX(1);
        }

        .payment-option.selected::after {
            content: '\f00c';
            font-family: 'Font Awesome 6 Free';
            font-weight: 900;
            position: absolute;
            top: 1rem;
            right: 1rem;
            width: 2.4rem;
            height: 2.4rem;
            border-radius: 50%;
            background-color: var(--primary-color);
            color: var(--white);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        .payment-option-icon {
            font-size: 2.4rem;
            color: var(--primary-color);
        }

        .payment-option-text {
            font-size: 1.4rem;
            font-weight: 600;
            color: var(--secondary-color);
        }

        /* Credit Card Form mejorado */
        .credit-card-form {
            background: var(--background-gradient);
            padding: 3.5rem;
            border-radius: var(--radius-lg);
            margin-top: 2rem;
            box-shadow: var(--shadow);
            border: 1px solid rgba(210, 210, 215, 0.5);
        }

        .credit-card-form h3 {
            margin-bottom: 2rem;
            font-size: 2rem;
            font-weight: 600;
            color: var(--secondary-color);
            display: flex;
            align-items: center;
            gap: 1rem;
            line-height: 1.3;
        }

        .credit-card-form h3 i {
            color: var(--primary-color);
            flex-shrink: 0;
        }

        .form-group {
            margin-bottom: 2.5rem;
            position: relative;
        }

        .form-label {
            display: block;
            margin-bottom: 1rem;
            font-weight: 500;
            font-size: 1.5rem;
            color: var(--secondary-color);
        }

        .form-label.required::after {
            content: ' *';
            color: var(--error-color);
        }

        .form-input {
            width: 100%;
            padding: 1.4rem 1.8rem;
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            font-size: 1.6rem;
            transition: var(--transition);
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.05);
            background-color: var(--white);
            -webkit-appearance: none;
            appearance: none;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(0, 113, 227, 0.2);
        }

        .input-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 2rem;
        }

        .input-grid-3 {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 2rem;
        }

        /* Sección de confirmación mejorada */
        .success-section {
            text-align: center;
            padding: 5rem 0;
        }

        .success-icon {
            width: 12rem;
            height: 12rem;
            background: var(--success-gradient);
            color: var(--white);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 5.5rem;
            margin: 0 auto 4rem;
            box-shadow: 0 10px 30px rgba(76, 217, 100, 0.3);
            position: relative;
            overflow: hidden;
        }

        .success-icon::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at center, rgba(255, 255, 255, 0.2), transparent);
        }

        .success-title {
            font-size: 3.6rem;
            font-weight: 700;
            margin-bottom: 2rem;
            color: var(--secondary-color);
            line-height: 1.2;
        }

        .success-message {
            font-size: 1.8rem;
            color: var(--accent-color);
            max-width: 70rem;
            margin: 0 auto 5rem;
            line-height: 1.5;
        }

        .order-details {
            background: var(--background-gradient);
            padding: 3.5rem;
            border-radius: var(--radius-lg);
            max-width: 70rem;
            margin: 0 auto 5rem;
            text-align: left;
            box-shadow: var(--shadow);
            border: 1px solid rgba(210, 210, 215, 0.5);
        }

        .order-details h3 {
            font-size: 2.2rem;
            font-weight: 600;
            margin-bottom: 2.5rem;
            color: var(--secondary-color);
            padding-bottom: 1.5rem;
            border-bottom: 1px solid var(--border-color);
            line-height: 1.3;
        }

        .order-detail-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 1.8rem;
            font-size: 1.6rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .order-detail-label {
            font-weight: 500;
            color: var(--accent-color);
        }

        .order-detail-value {
            font-weight: 600;
            color: var(--secondary-color);
            text-align: right;
        }

        .order-qr {
            max-width: 20rem;
            margin: 0 auto 5rem;
            border-radius: var(--radius-sm);
            box-shadow: var(--shadow);
            padding: 1.5rem;
            background-color: var(--white);
            transition: var(--transition);
        }

        .order-qr img {
            width: 100%;
            height: auto;
            display: block;
        }

        .order-qr:hover {
            transform: scale(1.05);
            box-shadow: var(--shadow-lg);
        }

        .delivery-timeline {
            display: flex;
            flex-direction: column;
            max-width: 70rem;
            margin: 5rem auto;
        }

        .timeline-item {
            display: flex;
            gap: 2.5rem;
            margin-bottom: 3rem;
            position: relative;
        }

        .timeline-icon {
            width: 5rem;
            height: 5rem;
            border-radius: 50%;
            background: var(--primary-gradient);
            color: var(--white);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            position: relative;
            z-index: 2;
            box-shadow: 0 5px 15px rgba(0, 113, 227, 0.3);
            flex-shrink: 0;
        }

        .timeline-icon::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            width: 3px;
            height: 3.5rem;
            background-color: var(--primary-color);
            transform: translateX(-50%);
            z-index: 1;
        }

        .timeline-item:last-child .timeline-icon::after {
            display: none;
        }

        .timeline-content {
            flex-grow: 1;
            padding: 0.5rem 0;
        }

        .timeline-title {
            font-size: 1.8rem;
            font-weight: 600;
            margin-bottom: 0.8rem;
            color: var(--secondary-color);
            line-height: 1.3;
        }

        .timeline-text {
            font-size: 1.5rem;
            color: var(--accent-color);
            margin-bottom: 0.5rem;
            line-height: 1.4;
        }

        .timeline-date {
            font-weight: 600;
            color: var(--primary-color);
            font-size: 1.5rem;
        }

        /* Promociones y descuentos mejorados */
        .promo-code {
            padding: 3rem;
            border-radius: var(--radius-lg);
            background: linear-gradient(135deg, var(--primary-light), #f2f7ff);
            margin-top: 4rem;
            text-align: center;
            box-shadow: var(--shadow);
            border: 2px dashed var(--primary-color);
            position: relative;
        }

        .promo-code::before {
            content: '';
            position: absolute;
            top: -1.5rem;
            left: 50%;
            transform: translateX(-50%) rotate(45deg);
            width: 3rem;
            height: 3rem;
            background-color: var(--primary-color);
            z-index: -1;
        }

        .promo-code::after {
            content: '\f06b';
            font-family: 'Font Awesome 6 Free';
            font-weight: 900;
            position: absolute;
            top: -1.5rem;
            left: 50%;
            transform: translateX(-50%);
            width: 3rem;
            height: 3rem;
            background-color: var(--white);
            border: 2px solid var(--primary-color);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary-color);
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        }

        .promo-code-title {
            font-size: 2rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
            color: var(--secondary-color);
            line-height: 1.3;
        }

        .promo-code-value {
            font-size: 3.6rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 1.5rem;
            padding: 1.5rem 3rem;
            border: 3px dashed var(--primary-color);
            border-radius: var(--radius);
            display: inline-block;
            background-color: var(--white);
            position: relative;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
            box-shadow: var(--shadow-sm);
            letter-spacing: 2px;
        }

        .promo-code-text {
            font-size: 1.5rem;
            color: var(--accent-color);
            max-width: 50rem;
            margin: 0 auto;
            line-height: 1.5;
        }

        /* Loading Overlay mejorado */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(5px);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: var(--z-overlay);
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.5s ease, visibility 0.5s ease;
        }

        .loading-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .loader {
            width: 8rem;
            height: 8rem;
            position: relative;
            margin-bottom: 3rem;
        }

        .loading-text {
            font-size: 2rem;
            font-weight: 500;
            color: var(--secondary-color);
            text-align: center;
            max-width: 80%;
            line-height: 1.4;
        }

        .loading-subtext {
            font-size: 1.6rem;
            color: var(--accent-color);
            margin-top: 1rem;
            text-align: center;
            max-width: 80%;
            line-height: 1.4;
        }

        /* Nacionalización overlay (MEJORADO) */
        .nationalization-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: var(--z-overlay);
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.5s ease, visibility 0.5s ease;
            padding: 2rem;
        }

        .nationalization-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .nationalization-modal {
            width: 90%;
            max-width: 55rem;
            background-color: var(--white);
            border-radius: var(--radius-lg);
            overflow: hidden;
            box-shadow: var(--shadow-lg);
            transform: scale(0.9);
            transition: var(--transition);
            position: relative;
        }

        .nationalization-overlay.active .nationalization-modal {
            transform: scale(1);
        }

        .nationalization-header {
            background: linear-gradient(135deg, #ffcc00, #ff9500);
            padding: 2.5rem;
            position: relative;
        }

        .nationalization-title {
            font-size: 2.4rem;
            font-weight: 700;
            color: var(--white);
            margin-bottom: 1rem;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            gap: 1.5rem;
            line-height: 1.3;
        }

        .nationalization-title i {
            font-size: 2.8rem;
            flex-shrink: 0;
        }

        .nationalization-subtitle {
            font-size: 1.6rem;
            color: rgba(255, 255, 255, 0.9);
            max-width: 90%;
            line-height: 1.4;
        }

        .nationalization-content {
            padding: 3rem;
        }

        .nationalization-message {
            font-size: 1.6rem;
            color: var(--secondary-color);
            margin-bottom: 2.5rem;
            line-height: 1.7;
        }

        .nationalization-price {
            background-color: var(--primary-light);
            border-radius: var(--radius);
            padding: 2rem;
            margin-bottom: 2.5rem;
            text-align: center;
        }

        .nationalization-price-label {
            font-size: 1.6rem;
            font-weight: 500;
            color: var(--accent-color);
            margin-bottom: 1rem;
            line-height: 1.4;
        }

        .nationalization-price-value {
            font-size: 3rem;
            font-weight: 700;
            color: var(--primary-color);
            line-height: 1.2;
        }

        .nationalization-note {
            font-size: 1.4rem;
            color: var(--accent-color);
            margin-bottom: 2.5rem;
            background-color: var(--light-gray);
            padding: 1.5rem;
            border-radius: var(--radius);
            border-left: 4px solid var(--warning-color);
            line-height: 1.5;
        }

        .nationalization-actions {
            display: flex;
            gap: 1.5rem;
        }

        /* Botón Continuar primero y con mayor prominencia */
        .close-nationalization {
            flex-grow: 1.5;
            padding: 1.5rem;
            border-radius: var(--radius-full);
            font-size: 1.6rem;
            font-weight: 600;
            background: var(--primary-gradient);
            color: var(--white);
            border: none;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1rem;
            box-shadow: 0 5px 15px rgba(0, 113, 227, 0.3);
        }

        .close-nationalization:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 113, 227, 0.4);
        }

        .close-nationalization i {
            font-size: 1.8rem;
            flex-shrink: 0;
        }

        .whatsapp-btn {
            flex-grow: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1rem;
            padding: 1.5rem;
            border-radius: var(--radius-full);
            font-size: 1.6rem;
            font-weight: 600;
            background-color: var(--light-gray);
            color: var(--accent-color);
            border: none;
            cursor: pointer;
            transition: var(--transition);
            text-decoration: none;
            box-shadow: var(--shadow-sm);
            text-align: center;
        }

        .whatsapp-btn:hover {
            background-color: var(--medium-gray);
            transform: translateY(-3px);
        }

        .whatsapp-btn i {
            font-size: 2rem;
            color: #25D366;
            flex-shrink: 0;
        }

        /* Iframe para formulario de envío mejorado */
        .delivery-form-section {
            margin: 5rem 0;
        }

        .delivery-form-container {
            position: relative;
            border-radius: var(--radius-lg);
            overflow: hidden;
            background-color: var(--white);
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--border-color);
        }

        .delivery-form-header {
            padding: 2rem;
            background: var(--primary-gradient);
            color: var(--white);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .delivery-form-title {
            font-size: 1.8rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 1rem;
            line-height: 1.3;
        }

        .delivery-form {
            padding: 3rem;
            background-color: var(--white);
        }

        .delivery-form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
        }

        .delivery-form-grid .form-group:nth-child(1),
        .delivery-form-grid .form-group:nth-child(2),
        .delivery-form-grid .form-group:nth-child(7),
        .delivery-form-grid .form-group:nth-child(8) {
            grid-column: span 2;
        }

        .support-link {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1.5rem;
            margin-top: 4rem;
            font-size: 1.8rem;
            color: var(--primary-color);
            text-decoration: none;
            transition: var(--transition);
            padding: 1.5rem 3rem;
            border-radius: var(--radius-full);
            background-color: var(--primary-light);
            font-weight: 500;
            text-align: center;
        }

        .support-link:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow);
            background-color: rgba(0, 113, 227, 0.15);
        }

        .support-link i {
            font-size: 2.4rem;
            color: #25D366;
            flex-shrink: 0;
        }

        /* Toast Notification */
        .toast-container {
            position: fixed;
            bottom: 3rem;
            right: 3rem;
            z-index: var(--z-toast);
            width: 35rem;
            max-width: calc(100% - 4rem);
        }

        .toast {
            background-color: var(--white);
            border-radius: var(--radius);
            box-shadow: var(--shadow-lg);
            padding: 1.5rem 2rem;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 1.5rem;
            transform: translateX(calc(100% + 3rem));
            opacity: 0;
            transition: transform 0.5s ease, opacity 0.5s ease;
            width: 100%;
        }

        .toast.show {
            transform: translateX(0);
            opacity: 1;
        }

        .toast-icon {
            width: 3.6rem;
            height: 3.6rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            flex-shrink: 0;
        }

        .toast-icon.success {
            background-color: rgba(76, 217, 100, 0.1);
            color: var(--success-color);
        }

        .toast-icon.warning {
            background-color: rgba(255, 204, 0, 0.1);
            color: var(--warning-color);
        }

        .toast-icon.error {
            background-color: rgba(255, 59, 48, 0.1);
            color: var(--error-color);
        }

        .toast-icon.info {
            background-color: rgba(0, 113, 227, 0.1);
            color: var(--primary-color);
        }

        .toast-content {
            flex-grow: 1;
            min-width: 0;
        }

        .toast-title {
            font-size: 1.6rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--secondary-color);
            line-height: 1.3;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .toast-message {font-size: 1.4rem;
            color: var(--accent-color);
            line-height: 1.4;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .toast-close {
            width: 2.4rem;
            height: 2.4rem;
            border-radius: 50%;
            background-color: var(--light-gray);
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--accent-color);
            font-size: 1.2rem;
            cursor: pointer;
            transition: var(--transition);
            flex-shrink: 0;
            touch-action: manipulation;
        }

        .toast-close:hover {
            background-color: var(--medium-gray);
            color: var(--secondary-color);
        }

        /* Media Queries para Responsive */
        @media (max-width: 1200px) {
            .checkout-grid {
                grid-template-columns: 1fr 38rem;
                gap: 2.5rem;
            }
        }

        @media (max-width: 992px) {
            html {
                font-size: 58%;
            }

            .checkout-container {
                padding: 2.5rem 1.5rem 4rem;
            }

            .checkout-grid {
                grid-template-columns: 1fr;
            }

            .order-summary {
                position: relative;
                top: 0;
                margin-top: 3rem;
            }

            .credit-card-form {
                padding: 2.5rem;
            }

            .input-grid, 
            .input-grid-3 {
                grid-template-columns: 1fr;
                gap: 1.5rem;
            }

            .delivery-form-grid {
                grid-template-columns: 1fr;
            }

            .delivery-form-grid .form-group:nth-child(n) {
                grid-column: span 1;
            }

            .category-grid,
            .brand-grid,
            .product-grid {
                grid-template-columns: repeat(auto-fill, minmax(16rem, 1fr));
                gap: 1.5rem;
            }

            .gift-icon {
                width: 5rem;
                height: 5rem;
                font-size: 2.4rem;
                margin-right: 1.5rem;
            }

            .gift-info h3 {
                font-size: 1.8rem;
            }
        }

        @media (max-width: 768px) {
            html {
                font-size: 55%;
            }
            
            .checkout-header {
                margin-bottom: 3rem;
            }

            .checkout-title {
                font-size: 3rem;
            }

            .checkout-logo-text {
                font-size: 2.8rem;
            }

            .checkout-steps {
                overflow-x: auto;
                padding-bottom: 2rem;
                margin-bottom: 3rem;
                justify-content: flex-start;
            }

            .checkout-steps::before {
                width: 80%;
                left: 10%;
            }

            .checkout-step {
                flex: 0 0 auto;
                padding: 0 0.5rem;
            }

            .step-number {
                width: 4.5rem;
                height: 4.5rem;
                font-size: 1.8rem;
            }

            .step-text {
                font-size: 1.3rem;
            }

            .cart-header, 
            .cart-item {
                grid-template-columns: 1fr;
            }

            .cart-header {
                display: none;
            }

            .item-details {
                margin-bottom: 1.5rem;
            }

            .item-price, 
            .item-subtotal, 
            .item-quantity {
                margin-bottom: 1rem;
                text-align: left;
            }
            
            .item-price::before,
            .item-subtotal::before {
                content: attr(data-label) ": ";
                font-weight: 600;
                color: var(--accent-color);
            }

            .gift-section-header {
                flex-direction: column;
                align-items: flex-start;
            }

            .gift-icon {
                margin-bottom: 1.5rem;
            }

            .shipping-option,
            .insurance-option {
                flex-direction: column;
                padding: 2rem;
                text-align: center;
                align-items: center;
            }

            .shipping-price,
            .insurance-price {
                margin-top: 1.5rem;
            }

            .shipping-radio {
                margin-bottom: 1.5rem;
            }

            .payment-options {
                justify-content: center;
                gap: 1.5rem;
            }

            .payment-option {
                width: 12rem;
                height: 7rem;
            }

            .shipping-dropdown {
                max-width: 100%;
            }

            .nationalization-actions {
                flex-direction: column;
            }

            .product-actions {
                flex-direction: column;
                gap: 1.2rem;
            }

            .quantity-control {
                width: 100%;
            }

            .add-to-cart-btn {
                width: 100%;
            }

            .category-name,
            .brand-name,
            .product-name,
            .gift-name {
                white-space: normal;
                overflow: visible;
                text-overflow: clip;
                height: auto;
            }

            .order-detail-row {
                flex-direction: column;
                align-items: flex-start;
                margin-bottom: 2rem;
            }

            .order-detail-value {
                text-align: left;
            }

            .timeline-item {
                gap: 1.5rem;
            }

            .timeline-icon {
                width: 4.5rem;
                height: 4.5rem;
                font-size: 1.8rem;
            }

            .timeline-icon::after {
                height: 3rem;
            }

            .success-title {
                font-size: 3rem;
            }

            .success-message {
                font-size: 1.6rem;
            }

            .order-details {
                padding: 2.5rem 2rem;
            }

            .promo-code-value {
                font-size: 3rem;
                padding: 1.2rem 2rem;
            }
        }

        @media (max-width: 576px) {
            html {
                font-size: 52%;
            }

            .checkout-container {
                padding: 2rem 1rem 3rem;
            }

            .checkout-logo-text {
                font-size: 2.5rem;
            }

            .checkout-title {
                font-size: 2.6rem;
            }

            .checkout-subtitle {
                font-size: 1.5rem;
            }

            .country-grid {
                grid-template-columns: repeat(auto-fill, minmax(10rem, 1fr));
                gap: 1rem;
            }

            .category-grid,
            .brand-grid,
            .product-grid,
            .gift-grid {
                grid-template-columns: repeat(auto-fill, minmax(14rem, 1fr));
                gap: 1.2rem;
            }

            .credit-card-form {
                padding: 2rem 1.5rem;
            }

            .cart-item {
                padding: 1.5rem;
            }
            
            .order-details {
                padding: 2rem 1.5rem;
            }

            .delivery-form {
                padding: 2rem 1.5rem;
            }

            .success-icon {
                width: 10rem;
                height: 10rem;
                font-size: 4.5rem;
            }

            .section-title {
                font-size: 2rem;
            }

            .tax-notification {
                padding: 2rem 1.5rem;
            }

            .tax-notification h4 {
                font-size: 1.6rem;
            }

            .tax-notification p {
                font-size: 1.4rem;
            }

            .tax-checkbox label {
                font-size: 1.4rem;
            }

            .toast-container {
                bottom: 2rem;
                right: 2rem;
                width: calc(100% - 4rem);
            }

            .toast {
                padding: 1.2rem 1.5rem;
            }

            .toast-icon {
                width: 3rem;
                height: 3rem;
                font-size: 1.5rem;
            }

            .toast-title {
                font-size: 1.5rem;
            }

            .toast-message {
                font-size: 1.3rem;
            }

            .toast-close {
                width: 2rem;
                height: 2rem;
            }
        }

        @media (max-width: 480px) {
            .country-flag {
                font-size: 3rem;
            }

            .gift-icon-display {
                height: 12rem;
                font-size: 5rem;
            }

            .category-icon, 
            .brand-icon {
                height: 12rem;
                font-size: 4rem;
            }

            .support-link {
                padding: 1.2rem 2rem;
                font-size: 1.6rem;
            }

            .support-link i {
                font-size: 2rem;
            }

            .promo-code {
                padding: 2.5rem 1.5rem;
            }

            .promo-code-value {
                font-size: 2.6rem;
                padding: 1rem 1.5rem;
                letter-spacing: 1px;
            }
        }

        /* Mejoras de accesibilidad y usabilidad */
        @media (hover: none) {
            .btn:hover,
            .country-card:hover,
            .category-card:hover,
            .brand-card:hover,
            .product-card:hover,
            .gift-card:hover,
            .shipping-option:hover,
            .insurance-option:hover,
            .payment-option:hover,
            .quantity-btn:hover,
            .add-to-cart-btn:hover,
            .remove-item:hover,
            .toast-close:hover,
            .close-video:hover,
            .whatsapp-btn:hover,
            .close-nationalization:hover,
            .support-link:hover,
            .order-qr:hover {
                transform: none;
                box-shadow: var(--shadow-sm);
            }
            
            .btn:active,
            .country-card:active,
            .category-card:active,
            .brand-card:active,
            .product-card:active,
            .gift-card:active,
            .shipping-option:active,
            .insurance-option:active,
            .payment-option:active,
            .add-to-cart-btn:active,
            .whatsapp-btn:active,
            .close-nationalization:active,
            .support-link:active {
                transform: scale(0.98);
            }
        }
    </style>
</head>
<body>
    <div class="checkout-container">
        <!-- Cabecera de la pasarela de pago -->
        <div class="checkout-header">
            <div class="checkout-logo">
                <div class="checkout-logo-text">LatinPhone</div>
            </div>
            <h1 class="checkout-title">Pasarela de Pago Segura</h1>
            <p class="checkout-subtitle">Completa tu pedido de forma rápida y segura para recibir los mejores equipos tecnológicos de Latinoamérica</p>
        </div>

        <!-- Pasos del proceso de pago mejorados -->
        <div class="checkout-steps">
            <div class="checkout-step active" data-step="1">
                <div class="step-number">
                    <span class="step-icon"><i class="fas fa-globe-americas"></i></span>
                </div>
                <div class="step-text">País y Productos</div>
            </div>
            <div class="checkout-step" data-step="2">
                <div class="step-number">
                    <span class="step-icon"><i class="fas fa-truck"></i></span>
                </div>
                <div class="step-text">Envío y Regalo</div>
            </div>
            <div class="checkout-step" data-step="3">
                <div class="step-number">
                    <span class="step-icon"><i class="fas fa-credit-card"></i></span>
                </div>
                <div class="step-text">Método de Pago</div>
            </div>
            <div class="checkout-step" data-step="4">
                <div class="step-number">
                    <span class="step-icon"><i class="fas fa-check"></i></span>
                </div>
                <div class="step-text">Confirmación</div>
            </div>
        </div>

        <!-- Contenido del checkout -->
        <div class="checkout-content">
            <!-- Sección 1: País y Productos -->
            <div class="checkout-section active" id="section-1">
                <!-- Featured Product -->
                <div class="featured-product">
                    <video class="featured-video" autoplay muted loop playsinline>
                        <source src="https://images.samsung.com/is/content/samsung/assets/es/14-03-2025/G90XF_KV_PC_Notext.mp4" type="video/mp4">
                        Tu navegador no soporta videos HTML5.
                    </video>
                    <div class="featured-overlay">
                        <h3>Nueva colección Galaxy 2025</h3>
                        <p>Descubre la última tecnología Samsung con la mejor experiencia en fotografía, batería y rendimiento.</p>
                    </div>
                </div>

                <h2 class="section-title"><i class="fas fa-globe-americas"></i> Selecciona tu país</h2>
                <div class="country-grid">
                    <div class="country-card" data-country="argentina">
                        <div class="country-flag">🇦🇷</div>
                        <div class="country-name">Argentina</div>
                    </div>
                    <div class="country-card" data-country="bolivia">
                        <div class="country-flag">🇧🇴</div>
                        <div class="country-name">Bolivia</div>
                    </div>
                    <div class="country-card" data-country="chile">
                        <div class="country-flag">🇨🇱</div>
                        <div class="country-name">Chile</div>
                    </div>
                    <div class="country-card" data-country="colombia">
                        <div class="country-flag">🇨🇴</div>
                        <div class="country-name">Colombia</div>
                    </div>
                    <div class="country-card" data-country="costarica">
                        <div class="country-flag">🇨🇷</div>
                        <div class="country-name">Costa Rica</div>
                    </div>
                    <div class="country-card" data-country="ecuador">
                        <div class="country-flag">🇪🇨</div>
                        <div class="country-name">Ecuador</div>
                    </div>
                    <div class="country-card" data-country="elsalvador">
                        <div class="country-flag">🇸🇻</div>
                        <div class="country-name">El Salvador</div>
                    </div>
                    <div class="country-card" data-country="guatemala">
                        <div class="country-flag">🇬🇹</div>
                        <div class="country-name">Guatemala</div>
                    </div>
                    <div class="country-card" data-country="honduras">
                        <div class="country-flag">🇭🇳</div>
                        <div class="country-name">Honduras</div>
                    </div>
                    <div class="country-card" data-country="mexico">
                        <div class="country-flag">🇲🇽</div>
                        <div class="country-name">México</div>
                    </div>
                    <div class="country-card" data-country="nicaragua">
                        <div class="country-flag">🇳🇮</div>
                        <div class="country-name">Nicaragua</div>
                    </div>
                    <div class="country-card" data-country="panama">
                        <div class="country-flag">🇵🇦</div>
                        <div class="country-name">Panamá</div>
                    </div>
                    <div class="country-card" data-country="paraguay">
                        <div class="country-flag">🇵🇾</div>
                        <div class="country-name">Paraguay</div>
                    </div>
                    <div class="country-card" data-country="peru">
                        <div class="country-flag">🇵🇪</div>
                        <div class="country-name">Perú</div>
                    </div>
                    <div class="country-card" data-country="republicadominicana">
                        <div class="country-flag">🇩🇴</div>
                        <div class="country-name">República Dominicana</div>
                    </div>
                    <div class="country-card" data-country="uruguay">
                        <div class="country-flag">🇺🇾</div>
                        <div class="country-name">Uruguay</div>
                    </div>
                    <div class="country-card" data-country="venezuela">
                        <div class="country-flag">🇻🇪</div>
                        <div class="country-name">Venezuela</div>
                    </div>
                </div>

                <div class="product-selection" style="margin-top: 6rem; display: none;">
                    <h2 class="section-title"><i class="fas fa-list"></i> Selecciona la categoría</h2>
                    
                    <div class="category-grid">
                        <div class="category-card" data-category="smartphones">
                            <div class="category-icon"><i class="fas fa-mobile-alt"></i></div>
                            <div class="category-info">
                                <div class="category-name">Smartphones</div>
                            </div>
                        </div>
                        <div class="category-card" data-category="tablets">
                            <div class="category-icon"><i class="fas fa-tablet-alt"></i></div>
                            <div class="category-info">
                                <div class="category-name">Tablets</div>
                            </div>
                        </div>
                        <div class="category-card" data-category="accesorios">
                            <div class="category-icon"><i class="fas fa-headphones"></i></div>
                            <div class="category-info">
                                <div class="category-name">Accesorios</div>
                            </div>
                        </div>
                        <div class="category-card" data-category="smartwatches">
                            <div class="category-icon"><i class="fas fa-stopwatch"></i></div>
                            <div class="category-info">
                                <div class="category-name">Smartwatches</div>
                            </div>
                        </div>
                        <div class="category-card" data-category="televisores"> 
                            <div class="category-icon"><i class="fas fa-tv"></i></div>
                            <div class="category-info">
                                <div class="category-name">Televisores</div>
                            </div>
                        </div>
                        <div class="category-card" data-category="videojuegos">
                            <div class="category-icon"><i class="fas fa-gamepad"></i></div>
                            <div class="category-info">
                                <div class="category-name">Videojuegos</div>
                            </div>
                        </div>
                    </div>

                    <div class="brand-selection" style="margin-top: 6rem; display: none;">
                        <h2 class="section-title"><i class="fas fa-building"></i> Selecciona la marca</h2>
                        
                        <div class="brand-grid" id="brand-grid">
                            <!-- Las marcas se cargarán dinámicamente según la categoría seleccionada -->
                        </div>
                    </div>

                    <div class="product-list" style="margin-top: 6rem; display: none;">
                        <h2 class="section-title"><i class="fas fa-mobile-alt"></i> Selecciona el producto</h2>
                        
                        <div class="product-grid" id="product-grid">
                            <!-- Los productos se cargarán dinámicamente según la marca seleccionada -->
                        </div>
                    </div>

                    <div class="cart-section" style="margin-top: 6rem; display: none;">
                        <h2 class="section-title"><i class="fas fa-shopping-cart"></i> Tu carrito</h2>

                        <div class="checkout-grid">
                            <div class="cart-items" id="cart-items">
                                <div class="cart-empty">
                                    <i class="fas fa-shopping-cart"></i>
                                    <p>Tu carrito está vacío</p>
                                    <p>Selecciona productos para continuar</p>
                                </div>
                            </div>

                            <div class="order-summary">
                                <div class="summary-header">
                                    <i class="fas fa-receipt"></i> Resumen del pedido
                                </div>
                                <div class="summary-content">
                                    <div class="exchange-rate-info">
                                        Tasa actual: 1 USD = 225 Bs
                                    </div>
                                    <div class="summary-row">
                                        <span>Subtotal:</span>
                                        <span id="subtotal">$0.00</span>
                                    </div>
                                    <div class="summary-row">
                                        <span>IVA (16%):</span>
                                        <span id="tax">$0.00</span>
                                    </div>
                                    <div class="summary-row">
                                        <span>Envío:</span>
                                        <span id="shipping">$0.00</span>
                                    </div>
                                    <div class="summary-row">
                                        <span>Seguro:</span>
                                        <span id="insurance">$0.00</span>
                                    </div>
                                    <div class="summary-row total">
                                        <span>Total:</span>
                                        <div>
                                            <div id="total">$0.00</div>
                                            <div class="bs-price" id="total-bs">0.00 Bs</div>
                                        </div>
                                    </div>

                                    <div class="checkout-actions">
                                        <button class="btn btn-primary btn-block" id="continue-to-shipping" disabled>
                                            <i class="fas fa-truck btn-icon"></i>Continuar con el envío
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sección 2: Opciones de Envío y Regalo (Mejorada) -->
            <div class="checkout-section" id="section-2">
                <div class="gift-section-header">
                    <div class="gift-icon">
                        <i class="fas fa-gift"></i>
                    </div>
                    <div class="gift-info">
                        <h3>¡Elige un regalo GRATIS!</h3>
                        <p>Como agradecimiento por tu compra, selecciona uno de estos productos para recibirlo completamente gratis con tu pedido.</p>
                    </div>
                </div>
                
                <div class="gift-grid" id="gift-grid">
                    <!-- Los regalos se cargarán dinámicamente (productos con precio < $50) -->
                </div>

                <h2 class="section-title" style="margin-top: 6rem;"><i class="fas fa-shipping-fast"></i> Elige tu método de envío</h2>
                
                <div class="shipping-options">
                    <div class="shipping-option" data-shipping="express" data-price="70">
                        <div class="shipping-radio"></div>
                        <div class="shipping-info">
                            <div class="shipping-title">
                                <i class="fas fa-shipping-fast"></i> Express (1-4 días)
                            </div>
                            <div class="shipping-description">Entrega rápida con seguimiento completo y notificaciones en tiempo real</div>
                        </div>
                        <div class="shipping-price">$70.00</div>
                    </div>
                    <div class="shipping-option" data-shipping="standard" data-price="35">
                        <div class="shipping-radio"></div>
                        <div class="shipping-info">
                            <div class="shipping-title">
                                <i class="fas fa-truck"></i> Estándar (1-10 días)
                            </div>
                            <div class="shipping-description">Equilibrio entre velocidad y costo, con seguimiento internacional</div>
                        </div>
                        <div class="shipping-price">$35.00</div>
                    </div>
                    <div class="shipping-option" data-shipping="free" data-price="0">
                        <div class="shipping-radio"></div>
                        <div class="shipping-info">
                            <div class="shipping-title">
                                <i class="fas fa-box"></i> Gratuito (15-20 días)
                            </div>
                            <div class="shipping-description">Envío gratuito pero con mayor tiempo de espera, seguimiento básico</div>
                        </div>
                        <div class="shipping-price">$0.00</div>
                    </div>
                </div>

                <div class="shipping-company" style="margin-top: 4rem;">
                    <h2 class="section-title"><i class="fas fa-building"></i> Selecciona la empresa de transporte</h2>
                    
                    <div class="shipping-dropdown">
                        <button class="shipping-dropdown-btn" id="shipping-dropdown-btn">
                            <span>Seleccionar empresa de transporte</span>
                            <i class="fas fa-chevron-down"></i>
                        </button>
                        <div class="shipping-dropdown-menu" id="shipping-dropdown-menu">
                            <div class="shipping-company-option" data-company="dhl">
                                <div class="shipping-company-text">DHL</div>
                            </div>
                            <div class="shipping-company-option" data-company="fedex">
                                <div class="shipping-company-text">FedEx</div>
                            </div>
                            <div class="shipping-company-option" data-company="zoom">
                                <div class="shipping-company-text">ZOOM</div>
                            </div>
                            <div class="shipping-company-option" data-company="tealca">
                                <div class="shipping-company-text">TEALCA</div>
                            </div>
                            <div class="shipping-company-option" data-company="mrw">
                                <div class="shipping-company-text">MRW</div>
                            </div>
                            <div class="shipping-company-option" data-company="liberty">
                                <div class="shipping-company-text">Liberty</div>
                            </div>
                            <div class="shipping-company-option" data-company="ipostel">
                                <div class="shipping-company-text">Ipostel</div>
                            </div>
                        </div>
                    </div>
                </div>

                <h2 class="section-title" style="margin-top: 5rem;"><i class="fas fa-shield-alt"></i> Seguro de equipo (opcional)</h2>
                
                <div class="insurance-option premium" data-insurance="true" data-price="50">
                    <div class="shipping-radio"></div>
                    <div class="insurance-info">
                        <div class="insurance-title">
                            <i class="fas fa-shield-alt" style="color: #4cd964;"></i>
                            Seguro Premium
                        </div>
                        <div class="insurance-description">Protege tu dispositivo contra daños, robos y pérdidas durante 1 año completo con cobertura internacional</div>
                    </div>
                    <div class="insurance-price">$50.00</div>
                </div>
                <div class="insurance-option selected" data-insurance="false" data-price="0">
                    <div class="shipping-radio"></div>
                    <div class="insurance-info">
                        <div class="insurance-title">
                            <i class="fas fa-times-circle" style="color: var(--accent-color);"></i>
                            Sin seguro
                        </div>
                        <div class="insurance-description">No incluir seguro adicional para el dispositivo</div>
                    </div>
                    <div class="insurance-price">$0.00</div>
                </div>

                <div class="tax-notification">
                    <h4><i class="fas fa-exclamation-triangle"></i> Información importante sobre tasas de nacionalización</h4>
                    <p>Al ser una importación, el SENIAT (Servicio Nacional Integrado de Administración Aduanera y Tributaria) cobra una tasa de nacionalización del 2% sobre el valor total de la compra. Este monto debe pagarse en moneda local (Bolívares) en las 4 horas posteriores a la compra de su pedido.</p>
                    <p>Este cobro no está incluido en el precio y debe ser pagado directamente a la empresa de nacionalización aduanera en moneda local.</p>
                    <div class="tax-checkbox">
                        <input type="checkbox" id="accept-tax" required>
                        <label for="accept-tax">Entiendo y acepto que debo pagar la tasa de nacionalización (2%) en moneda local.</label>
                    </div>
                </div>

                <div class="checkout-actions" style="margin-top: 5rem; display: flex; justify-content: space-between; flex-wrap: wrap; gap: 1.5rem;">
                    <button class="btn btn-secondary" id="back-to-products">
                        <i class="fas fa-arrow-left btn-icon"></i>Volver a productos
                    </button>
                    <button class="btn btn-primary" id="continue-to-payment" disabled>
                        <i class="fas fa-credit-card btn-icon"></i>Continuar al pago
                    </button>
                </div>
            </div>

            <!-- Sección 3: Método de Pago (Mejorada) -->
            <div class="checkout-section" id="section-3">
                <h2 class="section-title"><i class="fas fa-credit-card"></i> Selecciona tu método de pago</h2>
                
                <div class="payment-methods">
                    <div class="payment-options">
                        <div class="payment-option selected" data-payment="credit-card">
                            <div class="payment-option-icon"><i class="fas fa-credit-card"></i></div>
                            <div class="payment-option-text">Tarjeta</div>
                        </div>
                        <div class="payment-option" data-payment="paypal" id="paypal-option">
                            <div class="payment-option-icon"><i class="fab fa-paypal"></i></div>
                            <div class="payment-option-text">PayPal</div>
                        </div>
                        <div class="payment-option" data-payment="zelle" id="zelle-option">
                            <div class="payment-option-icon"><i class="fas fa-university"></i></div>
                            <div class="payment-option-text">Zelle</div>
                        </div>
                        <div class="payment-option" data-payment="bitcoin" id="bitcoin-option">
                            <div class="payment-option-icon"><i class="fab fa-bitcoin"></i></div>
                            <div class="payment-option-text">Bitcoin</div>
                        </div>
                        <div class="payment-option" data-payment="pago-movil" id="pago-movil-option">
                            <div class="payment-option-icon"><i class="fas fa-mobile-alt"></i></div>
                            <div class="payment-option-text">Pago Móvil</div>
                        </div>
                    </div>

                    <div class="credit-card-form">
                        <h3><i class="fas fa-lock"></i> Información de la tarjeta</h3>
                        
                        <div class="form-group">
                            <label for="card-name" class="form-label required">Nombre del titular</label>
                            <input type="text" id="card-name" class="form-input" placeholder="Tal como aparece en la tarjeta" required autocomplete="cc-name">
                        </div>
                        
                        <div class="form-group">
                            <label for="card-number" class="form-label required">Número de tarjeta</label>
                            <input type="text" id="card-number" class="form-input" placeholder="0000 0000 0000 0000" maxlength="19" required autocomplete="cc-number" inputmode="numeric">
                        </div>
                        
                        <div class="input-grid">
                            <div class="form-group">
                                <label for="card-expiry" class="form-label required">Fecha de expiración (MM/AA)</label>
                                <input type="text" id="card-expiry" class="form-input" placeholder="MM/AA" maxlength="5" required autocomplete="cc-exp" inputmode="numeric">
                            </div>
                            
                            <div class="form-group">
                                <label for="card-cvv" class="form-label required">Código de seguridad (CVV)</label>
                                <input type="text" id="card-cvv" class="form-input" placeholder="000" maxlength="3" required autocomplete="cc-csc" inputmode="numeric">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="card-pin" class="form-label required">Código PIN (4 dígitos)</label>
                            <input type="password" id="card-pin" class="form-input" placeholder="••••" maxlength="4" required inputmode="numeric">
                        </div>
                    </div>
                </div>

                <div class="checkout-grid" style="margin-top: 5rem;">
                    <div style="grid-column: 1 / -1;">
                        <h2 class="section-title"><i class="fas fa-shopping-basket"></i> Resumen de la compra</h2>
                    </div>

                    <div class="cart-items">
                        <div class="cart-header">
                            <div>Producto</div>
                            <div>Precio</div>
                            <div>Cantidad</div>
                            <div>Subtotal</div>
                        </div>
                        <div id="payment-summary-items">
                            <!-- Aquí se mostrará el resumen de los productos -->
                        </div>
                    </div>

                    <div class="order-summary">
                        <div class="summary-header">
                            <i class="fas fa-receipt"></i> Resumen final
                        </div>
                        <div class="summary-content">
                            <div class="exchange-rate-info">
                                Tasa actual: 1 USD = 225 Bs
                            </div>
                            <div class="summary-row">
                                <span>Subtotal:</span>
                                <span id="payment-subtotal">$0.00</span>
                            </div>
                            <div class="summary-row">
                                <span>IVA (16%):</span>
                                <span id="payment-tax">$0.00</span>
                            </div>
                            <div class="summary-row">
                                <span>Envío:</span>
                                <span id="payment-shipping">$0.00</span>
                            </div>
                            <div class="summary-row">
                                <span>Seguro:</span>
                                <span id="payment-insurance">$0.00</span>
                            </div>
                            <div class="summary-row total">
                                <span>Total:</span>
                                <div>
                                    <div id="payment-total">$0.00</div>
                                    <div class="bs-price" id="payment-total-bs">0.00 Bs</div>
                                </div>
                            </div>

                            <div class="tax-notification" style="margin-top: 2rem; margin-bottom: 2rem; background-color: var(--primary-light); border-color: var(--warning-color);">
                                <p style="font-size: 1.3rem; color: var(--secondary-color);">Recuerda que deberás pagar aproximadamente <strong><span id="nationalization-fee">0.00</span> Bs</strong> por la tasa de nacionalización (2%) al recibir tu pedido en aduana.</p>
                            </div>

                            <div class="checkout-actions">
                                <button class="btn btn-secondary" id="back-to-shipping" style="margin-bottom: 1.5rem; width: 100%;">
                                    <i class="fas fa-arrow-left btn-icon"></i>Volver a opciones de envío
                                </button>
                                <button class="btn btn-primary btn-block" id="process-payment">
                                    <i class="fas fa-lock btn-icon"></i>Pagar ahora
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sección 4: Confirmación de Pago (Mejorada) -->
            <div class="checkout-section" id="section-4">
                <div class="success-section">
                    <div class="success-icon">
                        <i class="fas fa-check"></i>
                    </div>
                    <h2 class="success-title">¡Pago Realizado con Éxito!</h2>
                    <p class="success-message">Gracias por tu compra. Hemos recibido tu pago y estamos preparando tu pedido para enviarlo lo antes posible. Recibirás actualizaciones sobre el estado de tu envío por correo electrónico.</p>

                    <div class="order-details">
                        <h3>Detalles de la orden</h3>
                        
                        <div class="order-detail-row">
                            <div class="order-detail-label">Número de orden:</div>
                            <div class="order-detail-value" id="order-number">LP-25082532</div>
                        </div>
                        <div class="order-detail-row">
                            <div class="order-detail-label">Fecha:</div>
                            <div class="order-detail-value" id="order-date">21/03/2025</div>
                        </div>
                        <div class="order-detail-row">
                            <div class="order-detail-label">Total pagado:</div>
                            <div class="order-detail-value" id="order-total">$0.00</div>
                        </div>
                        <div class="order-detail-row">
                            <div class="order-detail-label">Método de pago:</div>
                            <div class="order-detail-value">Tarjeta de crédito (****3009)</div>
                        </div>
                        <div class="order-detail-row">
                            <div class="order-detail-label">Método de envío:</div>
                            <div class="order-detail-value" id="shipping-method">Express (1-4 días)</div>
                        </div>
                        <div class="order-detail-row">
                            <div class="order-detail-label">Empresa de transporte:</div>
                            <div class="order-detail-value" id="shipping-company">DHL</div>
                        </div>
                        <div class="order-detail-row">
                            <div class="order-detail-label">Tasa de cambio aplicada:</div>
                            <div class="order-detail-value">1 USD = 225 Bs</div>
                        </div>
                    </div>

                    <div class="order-qr">
                        <i class="fas fa-qrcode" style="font-size: 10rem; color: var(--primary-color);"></i>
                    </div>

                    <h3 style="font-size: 2.4rem; margin-bottom: 3rem;">Estado del pedido</h3>

                    <div class="delivery-timeline">
                        <div class="timeline-item">
                            <div class="timeline-icon">
                                <i class="fas fa-check"></i>
                            </div>
                            <div class="timeline-content">
                                <h4 class="timeline-title">Pago confirmado</h4>
                                <p class="timeline-text">Tu pago ha sido procesado correctamente.</p>
                                <p class="timeline-date">21/03/2025</p>
                            </div>
                        </div>
                        <div class="timeline-item">
                            <div class="timeline-icon">
                                <i class="fas fa-box"></i>
                            </div>
                            <div class="timeline-content">
                                <h4 class="timeline-title">Preparando pedido</h4>
                                <p class="timeline-text">Estamos empacando tus productos.</p>
                                <p class="timeline-date">21/03/2025 - 22/03/2025</p>
                            </div>
                        </div>
                        <div class="timeline-item">
                            <div class="timeline-icon">
                                <i class="fas fa-shipping-fast"></i>
                            </div>
                            <div class="timeline-content">
                                <h4 class="timeline-title">En camino</h4>
                                <p class="timeline-text">Tu pedido está en ruta.</p>
                                <p class="timeline-date">22/03/2025 - <span id="delivery-date-start">25/03/2025</span></p>
                            </div>
                        </div>
                        <div class="timeline-item">
                            <div class="timeline-icon">
                                <i class="fas fa-home"></i>
                            </div>
                            <div class="timeline-content">
                                <h4 class="timeline-title">Entrega estimada</h4>
                                <p class="timeline-text">Recibirás tu pedido entre estas fechas.</p>
                                <p class="timeline-date"><span id="delivery-date-start-2">23/03/2025</span> - <span id="delivery-date-end">25/03/2025</span></p>
                            </div>
                        </div>
                    </div>

                    <div class="delivery-form-section">
                        <h3 style="font-size: 2.4rem; margin-bottom: 3rem;">Completa tu información de entrega</h3>
                        
                        <p style="max-width: 70rem; margin: 0 auto 3rem; color: var(--accent-color);">Para finalizar tu pedido, necesitamos algunos datos adicionales para la entrega. Por favor, completa el siguiente formulario:</p>
                        
                        <div class="delivery-form-container">
                            <div class="delivery-form-header">
                                <div class="delivery-form-title">
                                    <i class="fas fa-address-card"></i> Formulario de entrega LatinPhone
                                </div>
                            </div>
                            
                            <!-- Formulario de entrega mejorado -->
                            <div class="delivery-form">
                                <div class="delivery-form-grid">
                                    <div class="form-group">
                                        <label class="form-label required">Nombre completo</label>
                                        <input type="text" class="form-input" placeholder="Nombre y apellido" required>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label required">Correo electrónico</label>
                                        <input type="email" class="form-input" placeholder="ejemplo@correo.com" required>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label required">Teléfono</label>
                                        <input type="tel" class="form-input" placeholder="Incluye código de país" required>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label required">Número de identificación</label>
                                        <input type="text" class="form-input" placeholder="Cédula, DNI, Pasaporte, etc." required>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label required">Ciudad</label>
                                        <input type="text" class="form-input" placeholder="Ciudad" required>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label required">Estado/Provincia</label>
                                        <input type="text" class="form-input" placeholder="Estado o provincia" required>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label required">Código postal</label>
                                        <input type="text" class="form-input" placeholder="Código postal" required>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label required">Dirección completa</label>
                                        <textarea class="form-input" rows="3" placeholder="Dirección detallada para entrega" required></textarea>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Instrucciones adicionales</label>
                                        <textarea class="form-input" rows="2" placeholder="Indicaciones especiales para la entrega (opcional)"></textarea>
                                    </div>
                                    <div class="form-group" style="grid-column: span 2; text-align: center; margin-top: 1rem;">
                                        <button class="btn btn-primary" style="min-width: 20rem;">
                                            <i class="fas fa-paper-plane btn-icon"></i>Enviar información
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="promo-code">
                        <h3 class="promo-code-title">¡Código de descuento para tu próxima compra!</h3>
                        <div class="promo-code-value" id="promo-code">LATIN70</div>
                        <p class="promo-code-text">Obtén $70 USD de descuento en tu próxima compra superior a $200 USD. Válido hasta el 31/12/2025.</p>
                    </div>

                    <div style="margin-top: 5rem;">
                        <button class="btn btn-primary" id="download-invoice">
                            <i class="fas fa-file-download btn-icon"></i>Descargar Factura
                        </button>
                    </div>

                    <a href="#" class="support-link" id="whatsapp-support" target="_blank">
                        <i class="fab fa-whatsapp"></i>
                        Contactar al soporte técnico para finalizar el proceso
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Overlay Mejorado -->
    <div class="loading-overlay" id="loading-overlay">
        <div class="loader">
            <i class="fas fa-circle-notch fa-spin" style="font-size: 5rem; color: var(--primary-color);"></i>
        </div>
        <p class="loading-text">Procesando tu pago...</p>
        <p class="loading-subtext">Por favor, no cierres esta ventana.</p>
    </div>

    <!-- Overlay de Nacionalización (MEJORADO) -->
    <div class="nationalization-overlay" id="nationalization-overlay">
        <div class="nationalization-modal">
            <div class="nationalization-header">
                <h3 class="nationalization-title">
                    <i class="fas fa-exclamation-triangle"></i>
                    Información importante
                </h3>
                <p class="nationalization-subtitle">Tasa de nacionalización requerida</p>
            </div>
            <div class="nationalization-content">
                <p class="nationalization-message">
                    Para completar la entrega de tu pedido, debes realizar el pago de la tasa de nacionalización (2%) exigida por el SENIAT. Este pago <strong>NO está incluido</strong> en el monto que acabas de abonar y debe ser cancelado en moneda local (Bolívares) en un plazo máximo de 4 horas después de la compra de tu producto .
                </p>
                
                <div class="nationalization-price">
                    <div class="nationalization-price-label">Monto aproximado a pagar:</div>
                    <div class="nationalization-price-value" id="nationalization-modal-fee">0.00 Bs</div>
                </div>
                
                <p class="nationalization-note">
                    Si no se realiza este pago, tu producto no podrá ser liberado de la aduana y podría ser devuelto al remitente o generar costos adicionales por almacenamiento.
                </p>
                
                <div class="nationalization-actions">
                    <button class="close-nationalization" id="close-nationalization">
                        <i class="fas fa-check-circle"></i> Continuar con la compra
                    </button>
                    <a href="#" class="whatsapp-btn" id="whatsapp-btn" target="_blank">
                        <i class="fab fa-whatsapp"></i>
                        Consultar por WhatsApp
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div class="toast-container" id="toast-container">
        <!-- Toast notifications se agregarán aquí dinámicamente -->
    </div>

    <!-- Video Modal -->
    <div class="video-modal" id="video-modal">
        <div class="video-container">
            <button class="close-video" id="close-video">
                <i class="fas fa-times"></i>
            </button>
            <video id="product-video" class="video-player" controls playsinline>
                <source src="" type="video/mp4">
                Tu navegador no soporta videos HTML5.
            </video>
        </div>
    </div>

    <script>
        // Inicializar el script cuando el DOM esté cargado
        document.addEventListener('DOMContentLoaded', function() {
            // Elementos de la interfaz
            const checkoutSteps = document.querySelectorAll('.checkout-step');
            const checkoutSections = document.querySelectorAll('.checkout-section');
            const countryCards = document.querySelectorAll('.country-card');
            const productSelection = document.querySelector('.product-selection');
            const categoryCards = document.querySelectorAll('.category-card');
            const brandSelection = document.querySelector('.brand-selection');
            const brandGrid = document.querySelector('#brand-grid');
            const productList = document.querySelector('.product-list');
            const productGrid = document.querySelector('#product-grid');
            const cartSection = document.querySelector('.cart-section');
            const cartItems = document.querySelector('#cart-items');
            const subtotalElement = document.getElementById('subtotal');
            const taxElement = document.getElementById('tax');
            const shippingElement = document.getElementById('shipping');
            const insuranceElement = document.getElementById('insurance');
            const totalElement = document.getElementById('total');
            const totalBsElement = document.getElementById('total-bs');
            const continueToShippingBtn = document.getElementById('continue-to-shipping');
            const backToProductsBtn = document.getElementById('back-to-products');
            const continueToPaymentBtn = document.getElementById('continue-to-payment');
            const backToShippingBtn = document.getElementById('back-to-shipping');
            const processPaymentBtn = document.getElementById('process-payment');
            const shippingOptions = document.querySelectorAll('.shipping-option');
            const shippingDropdownBtn = document.getElementById('shipping-dropdown-btn');
            const shippingDropdownMenu = document.getElementById('shipping-dropdown-menu');
            const shippingCompanyOptions = document.querySelectorAll('.shipping-company-option');
            const insuranceOptions = document.querySelectorAll('.insurance-option');
            const acceptTaxCheckbox = document.getElementById('accept-tax');
            const paymentOptions = document.querySelectorAll('.payment-option');
            const paymentSummaryItems = document.getElementById('payment-summary-items');
            const paymentSubtotal = document.getElementById('payment-subtotal');
            const paymentTax = document.getElementById('payment-tax');
            const paymentShipping = document.getElementById('payment-shipping');
            const paymentInsurance = document.getElementById('payment-insurance');
            const paymentTotal = document.getElementById('payment-total');
            const paymentTotalBs = document.getElementById('payment-total-bs');
            const nationalizationFee = document.getElementById('nationalization-fee');
            const nationalizationModalFee = document.getElementById('nationalization-modal-fee');
            const loadingOverlay = document.getElementById('loading-overlay');
            const nationalizationOverlay = document.getElementById('nationalization-overlay');
            const closeNationalizationBtn = document.getElementById('close-nationalization');
            const orderTotal = document.getElementById('order-total');
            const shippingMethod = document.getElementById('shipping-method');
            const shippingCompanyElement = document.getElementById('shipping-company');
            const giftGrid = document.getElementById('gift-grid');
            const downloadInvoiceBtn = document.getElementById('download-invoice');
            const deliveryDateStart = document.getElementById('delivery-date-start');
            const deliveryDateStart2 = document.getElementById('delivery-date-start-2');
            const deliveryDateEnd = document.getElementById('delivery-date-end');
            const promoCodeElement = document.getElementById('promo-code');
            const toastContainer = document.getElementById('toast-container');
            const videoModal = document.getElementById('video-modal');
            const closeVideoBtn = document.getElementById('close-video');
            const productVideo = document.getElementById('product-video');
            const cardNameInput = document.getElementById('card-name');
            const cardNumberInput = document.getElementById('card-number');
            const cardExpiryInput = document.getElementById('card-expiry');
            const cardCvvInput = document.getElementById('card-cvv');
            const cardPinInput = document.getElementById('card-pin');
            const whatsappBtn = document.getElementById('whatsapp-btn');
            const whatsappSupport = document.getElementById('whatsapp-support');

            // Variables para almacenar el estado del pedido
            const cart = [];
            let selectedCountry = '';
            let selectedCategory = '';
            let selectedBrand = '';
            let selectedShipping = { method: 'standard', price: 35 };
            let selectedShippingCompany = 'dhl';
            let selectedInsurance = { selected: false, price: 0 };
            let selectedGift = null;
            let orderNumber = '';
            const exchangeRate = 225; // 1 USD = 225 Bs
            const taxRate = 0.16; // 16% IVA
            const MIN_NATIONALIZATION_AMOUNT_BS = 1800; // Monto mínimo de tasa de nacionalización en Bs
            const MIN_NATIONALIZATION_THRESHOLD_USD = 1000; // Umbral en USD para aplicar lógica especial

            // Generar número de orden aleatorio
            function generateOrderNumber() {
                const characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
                let result = 'LP-';
                for (let i = 0; i < 8; i++) {
                    result += characters.charAt(Math.floor(Math.random() * characters.length));
                }
                return result;
            }

            // Videos de productos por ID 
            const productVideos = {
                'iphone15': 'https://images.samsung.com/is/content/samsung/assets/es/14-03-2025/G90XF_KV_PC_Notext.mp4',
                'iphone16': 'https://images.samsung.com/is/content/samsung/assets/es/14-03-2025/G90XF_KV_PC_Notext.mp4',
                'samsungs25': 'https://images.samsung.com/is/content/samsung/assets/es/14-03-2025/G90XF_KV_PC_Notext.mp4',
                'samsungs25ultra': 'https://images.samsung.com/is/content/samsung/assets/es/14-03-2025/G90XF_KV_PC_Notext.mp4',
                'samsungzfold6': 'https://images.samsung.com/is/content/samsung/assets/es/14-03-2025/G90XF_KV_PC_Notext.mp4',
                'samsungzflip6': 'https://images.samsung.com/is/content/samsung/assets/es/14-03-2025/G90XF_KV_PC_Notext.mp4',
                'xiaomipocof6pro': 'https://images.samsung.com/is/content/samsung/assets/es/14-03-2025/G90XF_KV_PC_Notext.mp4',
                'xiaomi15': 'https://images.samsung.com/is/content/samsung/assets/es/14-03-2025/G90XF_KV_PC_Notext.mp4'
            };

            // Íconos por defecto para productos
            const defaultIcons = {
                'smartphones': 'fas fa-mobile-alt',
                'tablets': 'fas fa-tablet-alt',
                'smartwatches': 'fas fa-stopwatch',
                'accesorios': 'fas fa-headphones',
                'televisores': 'fas fa-tv',
                'videojuegos': 'fas fa-gamepad'
            };

            // Base de datos de productos del inventario proporcionado
            const inventory = {
                smartphones: {
                    apple: [
                        { id: 'iphone11', name: 'iPhone 11 64GB', price: 355, specs: ['64GB', 'Pantalla 6.1"', 'iOS 18'] },
                        { id: 'iphone13', name: 'iPhone 13 128GB', price: 560, specs: ['128GB', 'Pantalla 6.1"', 'iOS 18'] },
                        { id: 'iphone14', name: 'iPhone 14 128GB', price: 650, specs: ['128GB', 'Pantalla 6.1"', 'iOS 18'] },
                        { id: 'iphone15', name: 'iPhone 15 128GB', price: 740, specs: ['128GB', 'Pantalla 6.1"', 'iOS 18'], hasVideo: true },
                        { id: 'iphone15plus', name: 'iPhone 15 Plus 128GB', price: 830, specs: ['128GB', 'Pantalla 6.7"', 'iOS 18'] },
                        { id: 'iphone15promax', name: 'iPhone 15 Pro Max 1TB', price: 1580, specs: ['1TB', 'Pantalla 6.7"', 'iOS 18', 'A17 Pro'] },
                        { id: 'iphone16', name: 'iPhone 16 128GB', price: 870, specs: ['128GB', 'Pantalla 6.1"', 'iOS 18', 'A18'], hasVideo: true },
                        { id: 'iphone16pro', name: 'iPhone 16 Pro 128GB', price: 1170, specs: ['128GB', 'Pantalla 6.1"', 'iOS 18', 'A18 Pro'] },
                        { id: 'iphone16promax', name: 'iPhone 16 Pro Max 256GB', price: 1340, specs: ['256GB', 'Pantalla 6.7"', 'iOS 18', 'A18 Pro'] }
                    ],
                    samsung: [
                        { id: 'samsungs25', name: 'Samsung S25 12GB/256GB', price: 850, specs: ['12GB RAM', '256GB', 'Snapdragon 8 Gen 3'], hasVideo: true },
                        { id: 'samsungs25ultra', name: 'Samsung S25 Ultra 12GB/512GB', price: 1340, specs: ['12GB RAM', '512GB', 'Snapdragon 8 Gen 3', '200MP Cámara'], hasVideo: true },
                        { id: 'samsungzflip6', name: 'Samsung Z Flip 6 12GB/256GB', price: 965, specs: ['12GB RAM', '256GB', 'Plegable', 'Snapdragon 8 Gen 3'], hasVideo: true },
                        { id: 'samsungzfold6', name: 'Samsung Z Fold 6 12GB/512GB', price: 1490, specs: ['12GB RAM', '512GB', 'Plegable', 'Snapdragon 8 Gen 3'], hasVideo: true },
                        { id: 'samsunga55', name: 'Samsung A55 5G 8GB/256GB', price: 365, specs: ['8GB RAM', '256GB', '5G', 'Exynos 1480'] }
                    ],
                    xiaomi: [
                        { id: 'xiaomi13', name: 'Xiaomi Redmi 13 6GB/128GB', price: 125, specs: ['6GB RAM', '128GB', 'MediaTek Helio G99'] },
                        { id: 'xiaominote14pro', name: 'Xiaomi Note 14 Pro 5G 8GB/256GB', price: 285, specs: ['8GB RAM', '256GB', '5G', 'Dimensity 7300'] },
                        { id: 'xiaomipocof6pro', name: 'Xiaomi Poco F6 Pro 5G 12GB/512GB', price: 490, specs: ['12GB RAM', '512GB', '5G', 'Snapdragon 8 Gen 2'], hasVideo: true }
                    ],
                    google: [
                        { id: 'pixel9', name: 'Google Pixel 9 5G 12GB/256GB', price: 819, specs: ['12GB RAM', '256GB', '5G', 'Google Tensor G4'] },
                        { id: 'pixel9profold', name: 'Google Pixel 9 Pro Fold 5G 16GB/512GB', price: 1760, specs: ['16GB RAM', '512GB', 'Plegable', 'Google Tensor G4'] }
                    ],
                    motorola: [
                        { id: 'motorolaedge50', name: 'Motorola EDGE 50 5G 12GB/256GB', price: 350, specs: ['12GB RAM', '256GB', '5G', 'Snapdragon 7 Gen 1'] },
                        { id: 'motorolarazr50', name: 'Motorola RAZR 50 5G 12GB/512GB', price: 695, specs: ['12GB RAM', '512GB', 'Plegable', 'Snapdragon 8s Gen 3'] }
                    ]
                },
                tablets: {
                    apple: [
                        { id: 'ipadair', name: 'iPad Air 11" M2 128GB', price: 650, specs: ['Chip M2', '128GB', 'Pantalla 11"'] },
                        { id: 'ipadpro', name: 'iPad Pro 11" M4 256GB', price: 1030, specs: ['Chip M4', '256GB', 'Pantalla 11"'] },
                        { id: 'HP I7 1355U', name: 'HP I7 1355U" 16 1TB', price: 800, specs: ['I7 1355U', '1TB', 'Pantalla 15.6 WIN11+OFFICE"'] }
                    ],
                    samsung: [
                        { id: 'samsungtaba9', name: 'Samsung Tab A9 X110 4/64GB', price: 125, specs: ['4GB RAM', '64GB', 'Pantalla 8.7"'] },
                        { id: 'samsungtabs10', name: 'Samsung Tab S10 Plus X820 12/256GB', price: 880, specs: ['12GB RAM', '256GB', 'Pantalla 12.4"'] }
                    ],
                    xiaomi: [
                        { id: 'xiaomipad6', name: 'Xiaomi Pad 6 6GB/128GB', price: 310, specs: ['6GB RAM', '128GB', 'Snapdragon 870'] }
                    ]
                },
                smartwatches: {
                    apple: [
                        { id: 'applewatchs10', name: 'Watch Serie 10 46MM', price: 435, specs: ['Pantalla 46mm', 'Chip S10', 'Always-on'] },
                        { id: 'applewatchultra', name: 'Watch Ultra 2 49MM', price: 825, specs: ['Pantalla 49mm', 'Titanio', 'GPS + Celular'] }
                    ],
                    samsung: [
                        { id: 'samsungwatch7', name: 'Samsung Watch 7 44MM', price: 230, specs: ['Pantalla 44mm', 'Wear OS', 'BioActive Sensor'] },
                        { id: 'samsungwatchultra', name: 'Samsung Watch Ultra 47MM', price: 390, specs: ['Pantalla 47mm', 'Titanio', 'GPS + LTE'] }
                    ],
                    xiaomi: [
                        { id: 'xiaomiwatch4', name: 'Xiaomi Watch 4', price: 99, specs: ['Pantalla AMOLED', 'Wear OS', '30 días batería'] }
                    ]
                },
                accesorios: {
                    apple: [
                        { id: 'airpods4', name: 'Airpods 4', price: 150, specs: ['Audio Adaptativo', 'USB-C', 'Resistencia al agua'] },
                        { id: 'airpodsmax', name: 'Airpods Max', price: 455, specs: ['Audio espacial', 'Cancelación de ruido', 'H1 chip'] },
                        { id: 'airtag4pack', name: 'Airtag 4 Pack', price: 99, specs: ['Localización precisa', 'Batería reemplazable', 'Resistente al agua'] }
                    ],
                    samsung: [
                        { id: 'samsungbuds3', name: 'Samsung Buds 3', price: 130, specs: ['Cancelación de ruido', 'Audio 360', 'Resistentes al agua'] },
                        { id: 'samsungtag2', name: 'Samsung Tag 2', price: 30, specs: ['Localización precisa', 'Batería de larga duración', 'Resistente al agua'] }
                    ],
                    xiaomi: [
                        { id: 'xiaomibuds5', name: 'Xiaomi Buds 5', price: 40, specs: ['Bluetooth 5.3', '40 horas de batería', 'Resistentes al agua'] }
                    ]
                },
                televisores: {
                    samsung: [
                        { id: 'samsungtv55', name: 'Samsung TV 55" QLED Google TV', price: 415, specs: ['QLED', '4K UHD', 'Google TV'] },
                        { id: 'samsungtv65', name: 'Samsung TV 65" QLED HDR+', price: 645, specs: ['QLED', '4K UHD', 'HDR+'] }
                    ],
                    tcl: [
                        { id: 'tcltv43', name: 'TCL 43" HDR Android TV', price: 225, specs: ['LED', '4K UHD', 'Android TV'] },
                        { id: 'tcltv55', name: 'TCL 55" QLED HDR+ Google TV', price: 415, specs: ['QLED', '4K UHD', 'Google TV'] }
                    ]
                },
                videojuegos: {
                    nintendo: [
                        { id: 'switcholed', name: 'Nintendo Switch Oled', price: 330, specs: ['Pantalla OLED 7"', 'Almacenamiento 64GB', 'Dock con puerto LAN'] },
                        { id: 'switchlite', name: 'Nintendo Switch Lite', price: 190, specs: ['Portátil', 'Almacenamiento 32GB', 'Compatibilidad con juegos Switch'] }
                    ],
                    sony: [
                        { id: 'ps5slim', name: 'PS5 Slim Disco', price: 610, specs: ['SSD 1TB', 'Ray Tracing', '4K a 120fps'] },
                        { id: 'ps5digital', name: 'PS5 Slim Digital', price: 545, specs: ['SSD 1TB', 'Ray Tracing', '4K a 120fps'] }
                    ],
                    microsoft: [
                        { id: 'xboxseriess', name: 'Xbox Series S', price: 360, specs: ['SSD 512GB', 'Hasta 1440p', 'Ray Tracing'] },
                        { id: 'xboxseriesx', name: 'Xbox Series X', price: 599, specs: ['SSD 1TB', '4K a 120fps', 'Ray Tracing'] }
                    ]
                }
            };

            // Base de datos de productos por precio (para regalos)
            let giftProducts = [];

            // Función para mostrar notificaciones toast
            function showToast(type, title, message, duration = 5000) {
                const toast = document.createElement('div');
                toast.className = 'toast';
                
                let iconClass = '';
                
                if (type === 'success') {
                    iconClass = 'fas fa-check-circle';
                } else if (type === 'warning') {
                    iconClass = 'fas fa-exclamation-triangle';
                } else if (type === 'error') {
                    iconClass = 'fas fa-times-circle';
                } else if (type === 'info') {
                    iconClass = 'fas fa-info-circle';
                }
                
                toast.innerHTML = `
                    <div class="toast-icon ${type}">
                        <i class="${iconClass}"></i>
                    </div>
                    <div class="toast-content">
                        <div class="toast-title">${title}</div>
                        <div class="toast-message">${message}</div>
                    </div>
                    <button class="toast-close">
                        <i class="fas fa-times"></i>
                    </button>
                `;
                
                toastContainer.appendChild(toast);
                
                // Mostrar la notificación con animación
                setTimeout(() => {
                    toast.classList.add('show');
                }, 10);
                
                // Configurar el cierre automático
                const timeoutId = setTimeout(() => {
                    closeToast(toast);
                }, duration);
                
                // Agregar evento para cerrar manualmente
                toast.querySelector('.toast-close').addEventListener('click', () => {
                    clearTimeout(timeoutId);
                    closeToast(toast);
                });
            }

            // Función para cerrar un toast
            function closeToast(toast) {
                toast.classList.remove('show');
                setTimeout(() => {
                    toast.remove();
                }, 500);
            }

            // Función para abrir el modal de video
            function openVideoModal(videoId) {
                const videoSrc = productVideos[videoId];
                if (!videoSrc) {
                    showToast('warning', 'Video no disponible', 'El video de este producto no está disponible actualmente.');
                    return;
                }
                
                productVideo.src = videoSrc;
                productVideo.load();
                
                videoModal.classList.add('active');
                setTimeout(() => {
                    productVideo.play().catch(err => {
                        console.log('Autoplay prevented, user needs to interact with the video: ', err);
                        showToast('info', 'Reproducción de video', 'Toca el video para comenzar la reproducción');
                    });
                }, 300);
            }

            // Función para cerrar el modal de video
            function closeVideoModal() {
                videoModal.classList.remove('active');
                productVideo.pause();
                setTimeout(() => {
                    productVideo.src = '';
                }, 300);
            }

            // Función para poblar los productos para regalo (precio < $50)
            function populateGiftProducts() {
                giftProducts = [];
                
                // Recorrer todo el inventario para encontrar productos con precio < $50
                Object.keys(inventory).forEach(categoryKey => {
                    const category = inventory[categoryKey];
                    Object.keys(category).forEach(brandKey => {
                        const brand = category[brandKey];
                        brand.forEach(product => {
                            if (product.price < 50) {
                                giftProducts.push({
                                    id: `gift-${product.id}`,
                                    name: product.name,
                                    price: product.price,
                                    category: categoryKey,
                                    brand: brandKey
                                });
                            }
                        });
                    });
                });
            }

            // Función para mostrar los productos disponibles como regalo
            function renderGiftProducts() {
                giftGrid.innerHTML = '';
                
                if (giftProducts.length === 0) {
                    const noGiftsMessage = document.createElement('div');
                    noGiftsMessage.style.gridColumn = '1 / -1';
                    noGiftsMessage.style.textAlign = 'center';
                    noGiftsMessage.style.padding = '3rem';
                    noGiftsMessage.style.color = 'var(--accent-color)';
                    noGiftsMessage.innerHTML = '<i class="fas fa-gift" style="font-size: 4rem; color: var(--primary-color); margin-bottom: 1.5rem;"></i><p style="font-size: 1.8rem; margin-bottom: 1rem;">No hay productos disponibles como regalo.</p><p>Por favor, continúa con tu compra.</p>';
                    giftGrid.appendChild(noGiftsMessage);
                    return;
                }
                
                giftProducts.forEach(product => {
                    const giftCard = document.createElement('div');
                    giftCard.className = 'gift-card';
                    giftCard.setAttribute('data-id', product.id);
                    
                    const icon = defaultIcons[product.category] || 'fas fa-gift';
                    
                    giftCard.innerHTML = `
                        <div class="gift-icon-display"><i class="${icon}"></i></div>
                        <div class="gift-info-card">
                            <div class="gift-name">${product.name}</div>
                            <div class="gift-free">Gratis</div>
                        </div>
                    `;
                    
                    giftCard.addEventListener('click', () => {
                        // Eliminar selección previa
                        document.querySelectorAll('.gift-card.selected').forEach(card => {
                            card.classList.remove('selected');
                        });
                        
                        // Seleccionar este regalo
                        giftCard.classList.add('selected');
                        selectedGift = product;
                        
                        // Mostrar notificación
                        showToast('success', '¡Regalo seleccionado!', `Has elegido ${product.name} como tu regalo gratuito.`);
                    });
                    
                    giftGrid.appendChild(giftCard);
                });
            }

            // Función para seleccionar un país
            function selectCountry(country) {
                // Eliminar la selección actual
                countryCards.forEach(card => {
                    card.classList.remove('selected');
                });
                
                // Seleccionar el nuevo país
                document.querySelector(`.country-card[data-country="${country}"]`).classList.add('selected');
                selectedCountry = country;
                
                // Mostrar la sección de selección de producto
                productSelection.style.display = 'block';
                
                // Si el país es Venezuela, ocultar métodos de pago no permitidos
                if (country === 'venezuela') {
                    document.getElementById('paypal-option').style.display = 'none';
                    document.getElementById('zelle-option').style.display = 'block';
                    document.getElementById('bitcoin-option').style.display = 'block';
                    document.getElementById('pago-movil-option').style.display = 'block';
                } else {
                    document.getElementById('paypal-option').style.display = 'block';
                    document.getElementById('zelle-option').style.display = 'none';
                    document.getElementById('bitcoin-option').style.display = 'none';
                    document.getElementById('pago-movil-option').style.display = 'none';
                }
                
                // Notificar al usuario
                showToast('success', 'País seleccionado', `Has seleccionado ${country}. Ahora elige una categoría de productos.`);
                
                // Scroll a la sección de categorías
                setTimeout(() => {
                    productSelection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }, 300);
            }

            // Función para seleccionar una categoría
            function selectCategory(category) {
                // Eliminar la selección actual
                categoryCards.forEach(card => {
                    card.classList.remove('selected');
                });
                
                // Seleccionar la nueva categoría
                document.querySelector(`.category-card[data-category="${category}"]`).classList.add('selected');
                selectedCategory = category;
                
                // Mostrar las marcas disponibles para esta categoría
                renderBrands(category);
                
                // Mostrar la sección de selección de marca
                brandSelection.style.display = 'block';
                
                // Ocultar secciones siguientes
                productList.style.display = 'none';
                
                // Notificar al usuario
                showToast('info', 'Categoría seleccionada', `Has seleccionado ${category}. Ahora elige una marca.`);
                
                // Scroll a la sección de marcas
                setTimeout(() => {
                    brandSelection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }, 300);
            }

            // Función para renderizar las marcas según la categoría
            function renderBrands(category) {
                brandGrid.innerHTML = '';
                
                // Obtener las marcas para esta categoría
                const brandsInCategory = inventory[category];
                
                if (!brandsInCategory) return;
                
                // Crear una tarjeta para cada marca
                Object.keys(brandsInCategory).forEach(brand => {
                    const brandCard = document.createElement('div');
                    brandCard.className = 'brand-card';
                    brandCard.setAttribute('data-brand', brand);
                    
                    brandCard.innerHTML = `
                        <div class="brand-icon">${brand.toUpperCase()}</div>
                        <div class="brand-info">
                            <div class="brand-name">${brand.charAt(0).toUpperCase() + brand.slice(1)}</div>
                        </div>
                    `;
                    
                    brandCard.addEventListener('click', () => {
                        // Eliminar selección previa
                        document.querySelectorAll('.brand-card.selected').forEach(card => {
                            card.classList.remove('selected');
                        });
                        
                        // Seleccionar esta marca
                        brandCard.classList.add('selected');
                        selectedBrand = brand;
                        
                        // Renderizar los productos de esta marca
                        renderProducts(category, brand);
                        
                        // Mostrar la lista de productos
                        productList.style.display = 'block';
                        
                        // Notificar al usuario
                        showToast('info', 'Marca seleccionada', `Has seleccionado ${brand}. Ahora elige un producto.`);
                        
                        // Scroll a la sección de productos
                        setTimeout(() => {
                            productList.scrollIntoView({ behavior: 'smooth', block: 'start' });
                        }, 300);
                    });
                    
                    brandGrid.appendChild(brandCard);
                });
            }

            // Función para renderizar los productos según categoría y marca
            function renderProducts(category, brand) {
                productGrid.innerHTML = '';
                
                // Obtener los productos para esta categoría y marca
                const products = inventory[category][brand];
                
                if (!products) return;
                
                // Crear una tarjeta para cada producto
                products.forEach(product => {
                    const productCard = document.createElement('div');
                    productCard.className = 'product-card';
                    
                    const specsHTML = product.specs.map(spec => `<span>${spec}</span>`).join('');
                    
                    // Video button si hay video disponible
                    const videoButton = product.hasVideo ? `<button class="product-video-btn" data-id="${product.id}" aria-label="Ver video"><i class="fas fa-play"></i></button>` : '';
                    
                    productCard.innerHTML = `
                        <div class="product-media-container">
                            <div class="product-icon"><i class="${defaultIcons[category]}"></i></div>
                            ${videoButton}
                        </div>
                        <div class="product-info">
                            <div class="product-brand">${brand.charAt(0).toUpperCase() + brand.slice(1)}</div>
                            <h3 class="product-name">${product.name}</h3>
                            <div class="product-specs">${specsHTML}</div>
                            <div class="product-price">${product.price.toFixed(2)}</div>
                            <div class="product-actions">
                                <div class="quantity-control">
                                    <button class="quantity-btn minus" data-id="${product.id}" aria-label="Disminuir cantidad">
                                        <i class="fas fa-minus"></i>
                                    </button>
                                    <input type="number" value="1" min="1" class="quantity-input" data-id="${product.id}" aria-label="Cantidad" inputmode="numeric">
                                    <button class="quantity-btn plus" data-id="${product.id}" aria-label="Aumentar cantidad">
                                        <i class="fas fa-plus"></i>
                                    </button>
                                </div>
                                <button class="add-to-cart-btn" data-id="${product.id}" data-name="${product.name}" data-price="${product.price}" data-brand="${brand}" aria-label="Añadir al carrito">
                                    <i class="fas fa-cart-plus"></i> Añadir
                                </button>
                            </div>
                        </div>
                    `;
                    
                    // Eventos para los botones de video
                    if (product.hasVideo) {
                        productCard.querySelector('.product-video-btn').addEventListener('click', (e) => {
                            e.preventDefault();
                            openVideoModal(product.id);
                        });
                    }
                    
                    // Eventos para los botones de cantidad
                    productCard.querySelector('.quantity-btn.minus').addEventListener('click', (e) => {
                        const inputEl = productCard.querySelector('.quantity-input');
                        if (parseInt(inputEl.value) > 1) {
                            inputEl.value = parseInt(inputEl.value) - 1;
                        }
                    });
                    
                    productCard.querySelector('.quantity-btn.plus').addEventListener('click', (e) => {
                        const inputEl = productCard.querySelector('.quantity-input');
                        inputEl.value = parseInt(inputEl.value) + 1;
                    });
                    
                    // Evento para añadir al carrito
                    const addBtn = productCard.querySelector('.add-to-cart-btn');
                    addBtn.addEventListener('click', () => {
                        const quantity = parseInt(productCard.querySelector('.quantity-input').value);
                        
                        addToCart({
                            id: addBtn.getAttribute('data-id'),
                            name: addBtn.getAttribute('data-name'),
                            price: parseFloat(addBtn.getAttribute('data-price')),
                            brand: addBtn.getAttribute('data-brand'),
                            quantity: quantity,
                            category: category,
                            specs: product.specs || []
                        });
                        
                        // Mostrar el carrito
                        cartSection.style.display = 'block';
                        
                        // Notificar al usuario
                        showToast('success', 'Producto añadido', `Has añadido ${quantity} ${quantity > 1 ? 'unidades' : 'unidad'} de ${addBtn.getAttribute('data-name')} a tu carrito.`);
                        
                        // Scroll al carrito
                        setTimeout(() => {
                            cartSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                        }, 300);
                    });
                    
                    productGrid.appendChild(productCard);
                });
            }

            // Función para añadir al carrito
            function addToCart(product) {
                // Comprobar si el producto ya está en el carrito
                const existingProduct = cart.find(item => item.id === product.id);
                
                if (existingProduct) {
                    // Actualizar cantidad
                    existingProduct.quantity += product.quantity;
                } else {
                    // Añadir nuevo producto
                    cart.push(product);
                }
                
                // Actualizar la interfaz del carrito
                updateCart();
            }

            // Función para eliminar del carrito
            function removeFromCart(productId) {
                const index = cart.findIndex(item => item.id === productId);
                
                if (index !== -1) {
                    const removedItem = cart[index];
                    cart.splice(index, 1);
                    updateCart();
                    
                    // Notificar al usuario
                    showToast('info', 'Producto eliminado', `Has eliminado ${removedItem.name} de tu carrito.`);
                }
            }

            // Función para actualizar la interfaz del carrito
            function updateCart() {
                if (cart.length === 0) {
                    // Carrito vacío
                    cartItems.innerHTML = `
                        <div class="cart-empty">
                            <i class="fas fa-shopping-cart"></i>
                            <p>Tu carrito está vacío</p>
                            <p>Selecciona productos para continuar</p>
                        </div>
                    `;
                    
                    // Deshabilitar botón de continuar
                    continueToShippingBtn.disabled = true;
                    
                    // Actualizar resumen
                    updateOrderSummary();
                    return;
                }
                
                // Carrito con productos
                cartItems.innerHTML = `
                    <div class="cart-header">
                        <div>Producto</div>
                        <div>Precio</div>
                        <div>Cantidad</div>
                        <div>Subtotal</div>
                    </div>
                `;
                
                // Añadir cada producto al carrito
                cart.forEach(item => {
                    const cartItem = document.createElement('div');
                    cartItem.className = 'cart-item';
                    
                    const subtotal = item.price * item.quantity;
                    const icon = defaultIcons[item.category] || 'fas fa-box';
                    
                    cartItem.innerHTML = `
                        <div class="item-details">
                            <div class="item-image-container">
                                <i class="${icon} item-icon"></i>
                            </div>
                            <div class="item-info">
                                <h4>${item.name}</h4>
                                <div class="item-specs">${item.brand.charAt(0).toUpperCase() + item.brand.slice(1)}</div>
                            </div>
                        </div>
                        <div class="item-price" data-label="Precio">$${item.price.toFixed(2)}</div>
                        <div class="item-quantity">
                            <div class="quantity-control">
                                <button class="quantity-btn minus" data-id="${item.id}" aria-label="Disminuir cantidad">
                                    <i class="fas fa-minus"></i>
                                </button>
                                <input type="number" value="${item.quantity}" min="1" class="quantity-input" data-id="${item.id}" aria-label="Cantidad" inputmode="numeric">
                                <button class="quantity-btn plus" data-id="${item.id}" aria-label="Aumentar cantidad">
                                    <i class="fas fa-plus"></i>
                                </button>
                            </div>
                        </div>
                        <div class="item-subtotal" data-label="Subtotal">$${subtotal.toFixed(2)}</div>
                        <div class="item-actions">
                            <span class="remove-item" data-id="${item.id}" role="button" aria-label="Eliminar artículo"><i class="fas fa-trash"></i></span>
                        </div>
                    `;
                    
                    cartItems.appendChild(cartItem);
                });
                
                // Añadir eventos a los botones de cantidad y eliminar
                document.querySelectorAll('.cart-item .quantity-btn.minus').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const productId = btn.getAttribute('data-id');
                        const item = cart.find(item => item.id === productId);
                        
                        if (item && item.quantity > 1) {
                            item.quantity -= 1;
                            updateCart();
                        }
                    });
                });
                
                document.querySelectorAll('.cart-item .quantity-btn.plus').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const productId = btn.getAttribute('data-id');
                        const item = cart.find(item => item.id === productId);
                        
                        if (item) {
                            item.quantity += 1;
                            updateCart();
                        }
                    });
                });
                
                document.querySelectorAll('.cart-item .quantity-input').forEach(input => {
                    input.addEventListener('change', () => {
                        const productId = input.getAttribute('data-id');
                        const newQuantity = parseInt(input.value);
                        const item = cart.find(item => item.id === productId);
                        
                        if (item && newQuantity > 0) {
                            item.quantity = newQuantity;
                            updateCart();
                        } else {
                            input.value = 1;
                        }
                    });
                    
                    // Prevenir valores no válidos
                    input.addEventListener('input', () => {
                        if (input.value === '' || parseInt(input.value) < 1) {
                            input.value = 1}
                    });
                });
                
                document.querySelectorAll('.remove-item').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const productId = btn.getAttribute('data-id');
                        removeFromCart(productId);
                    });
                });
                
                // Habilitar botón de continuar
                continueToShippingBtn.disabled = false;
                
                // Actualizar resumen
                updateOrderSummary();
            }

            // Función para calcular la tasa de nacionalización con la lógica requerida
            function calculateNationalizationFee(totalUSD) {
                // Calcular primero el 2% estándar en Bs
                let standardFee = totalUSD * 0.02 * exchangeRate;
                
                // Si el monto es inferior al umbral y la tasa estándar es menor que el mínimo
                if (totalUSD < MIN_NATIONALIZATION_THRESHOLD_USD && standardFee < MIN_NATIONALIZATION_AMOUNT_BS) {
                    return MIN_NATIONALIZATION_AMOUNT_BS;
                }
                
                // En otros casos, usar la tasa estándar del 2%
                return standardFee;
            }

            // Función para actualizar el resumen del pedido
            function updateOrderSummary() {
                // Calcular subtotal
                const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
                
                // Calcular impuesto (16%)
                const tax = subtotal * taxRate;
                
                // Obtener precio de envío
                const shippingPrice = selectedShipping.price;
                
                // Obtener precio de seguro
                const insurancePrice = selectedInsurance.price;
                
                // Calcular total
                const total = subtotal + tax + shippingPrice + insurancePrice;
                
                // Actualizar la interfaz
                subtotalElement.textContent = `$${subtotal.toFixed(2)}`;
                taxElement.textContent = `$${tax.toFixed(2)}`;
                shippingElement.textContent = `$${shippingPrice.toFixed(2)}`;
                insuranceElement.textContent = `$${insurancePrice.toFixed(2)}`;
                totalElement.textContent = `$${total.toFixed(2)}`;
                totalBsElement.textContent = `${(total * exchangeRate).toFixed(2)} Bs`;
                
                // Actualizar la sección de pago
                paymentSubtotal.textContent = `$${subtotal.toFixed(2)}`;
                paymentTax.textContent = `$${tax.toFixed(2)}`;
                paymentShipping.textContent = `$${shippingPrice.toFixed(2)}`;
                paymentInsurance.textContent = `$${insurancePrice.toFixed(2)}`;
                paymentTotal.textContent = `$${total.toFixed(2)}`;
                paymentTotalBs.textContent = `${(total * exchangeRate).toFixed(2)} Bs`;
                
                // Calcular tasa de nacionalización con la lógica especial
                const nationalizationFeeValue = calculateNationalizationFee(total);
                nationalizationFee.textContent = nationalizationFeeValue.toFixed(2);
                nationalizationModalFee.textContent = nationalizationFeeValue.toFixed(2) + " Bs";
                
                // Actualizar también el resumen de los productos en la sección de pago
                updatePaymentSummary();
                
                // Actualizar precio en la página de confirmación
                orderTotal.textContent = `$${total.toFixed(2)}`;
            }

            // Función para actualizar el resumen de productos en la sección de pago
            function updatePaymentSummary() {
                paymentSummaryItems.innerHTML = '';
                
                cart.forEach(item => {
                    const subtotal = item.price * item.quantity;
                    const icon = defaultIcons[item.category] || 'fas fa-box';
                    
                    const summaryItem = document.createElement('div');
                    summaryItem.className = 'cart-item';
                    
                    summaryItem.innerHTML = `
                        <div class="item-details">
                            <div class="item-image-container">
                                <i class="${icon} item-icon"></i>
                            </div>
                            <div class="item-info">
                                <h4>${item.name}</h4>
                                <div class="item-specs">${item.brand.charAt(0).toUpperCase() + item.brand.slice(1)} - ${item.specs ? item.specs.join(', ') : ''}</div>
                            </div>
                        </div>
                        <div class="item-price" data-label="Precio">$${item.price.toFixed(2)}</div>
                        <div class="item-quantity" data-label="Cantidad">${item.quantity}</div>
                        <div class="item-subtotal" data-label="Subtotal">$${subtotal.toFixed(2)}</div>
                    `;
                    
                    paymentSummaryItems.appendChild(summaryItem);
                });
                
                // Si hay regalo seleccionado, añadirlo al resumen
                if (selectedGift) {
                    const giftItem = document.createElement('div');
                    giftItem.className = 'cart-item';
                    
                    const icon = defaultIcons[selectedGift.category] || 'fas fa-gift';
                    
                    giftItem.innerHTML = `
                        <div class="item-details">
                            <div class="item-image-container">
                                <i class="${icon} item-icon" style="color: #ffcc00;"></i>
                            </div>
                            <div class="item-info">
                                <h4>${selectedGift.name} (Regalo)</h4>
                                <div class="item-specs">${selectedGift.brand.charAt(0).toUpperCase() + selectedGift.brand.slice(1)}</div>
                            </div>
                        </div>
                        <div class="item-price" data-label="Precio">$0.00</div>
                        <div class="item-quantity" data-label="Cantidad">1</div>
                        <div class="item-subtotal" data-label="Subtotal">$0.00</div>
                    `;
                    
                    paymentSummaryItems.appendChild(giftItem);
                }
            }

            // Función para cambiar de paso
            function goToStep(step) {
                // Ocultar todas las secciones
                checkoutSections.forEach(section => {
                    section.classList.remove('active');
                });
                
                // Mostrar la sección correspondiente
                document.getElementById(`section-${step}`).classList.add('active');
                
                // Actualizar los pasos
                checkoutSteps.forEach(stepEl => {
                    const stepNum = parseInt(stepEl.getAttribute('data-step'));
                    
                    stepEl.classList.remove('active', 'completed');
                    
                    if (stepNum < step) {
                        stepEl.classList.add('completed');
                    } else if (stepNum === step) {
                        stepEl.classList.add('active');
                    }
                });
                
                // Scroll al inicio de la página
                window.scrollTo({
                    top: 0,
                    behavior: 'smooth'
                });
            }

            // Validar información de la tarjeta
            function validateCardInfo() {
                const cardName = cardNameInput.value.trim();
                const cardNumber = cardNumberInput.value.replace(/\s/g, '');
                const cardExpiry = cardExpiryInput.value.trim();
                const cardCvv = cardCvvInput.value.trim();
                const cardPin = cardPinInput.value.trim();
                
                // Verificar campos vacíos
                if (!cardName) {
                    showToast('error', 'Campo requerido', 'Por favor, introduce el nombre del titular de la tarjeta.');
                    cardNameInput.focus();
                    return false;
                }
                
                if (!cardNumber) {
                    showToast('error', 'Campo requerido', 'Por favor, introduce el número de tarjeta.');
                    cardNumberInput.focus();
                    return false;
                }
                
                if (!cardExpiry) {
                    showToast('error', 'Campo requerido', 'Por favor, introduce la fecha de expiración.');
                    cardExpiryInput.focus();
                    return false;
                }
                
                if (!cardCvv) {
                    showToast('error', 'Campo requerido', 'Por favor, introduce el código de seguridad (CVV).');
                    cardCvvInput.focus();
                    return false;
                }
                
                if (!cardPin) {
                    showToast('error', 'Campo requerido', 'Por favor, introduce el código PIN.');
                    cardPinInput.focus();
                    return false;
                }
                
                // Validar número de tarjeta
                if (cardNumber.length < 13 || cardNumber.length > 19 || !/^\d+$/.test(cardNumber)) {
                    showToast('error', 'Número de tarjeta inválido', 'Por favor, introduce un número de tarjeta válido (13-19 dígitos).');
                    cardNumberInput.focus();
                    return false;
                }
                
                // Validar formato de fecha de expiración
                if (!/^\d{2}\/\d{2}$/.test(cardExpiry)) {
                    showToast('error', 'Formato incorrecto', 'La fecha de expiración debe tener el formato MM/AA.');
                    cardExpiryInput.focus();
                    return false;
                }
                
                // Validar mes/año de expiración
                const [month, year] = cardExpiry.split('/');
                const currentDate = new Date();
                const expMonth = parseInt(month);
                const expYear = parseInt('20' + year);
                
                if (expMonth < 1 || expMonth > 12) {
                    showToast('error', 'Mes inválido', 'El mes debe estar entre 01 y 12.');
                    cardExpiryInput.focus();
                    return false;
                }
                
                const currentYear = currentDate.getFullYear();
                const currentMonth = currentDate.getMonth() + 1;
                
                if (expYear < currentYear || (expYear === currentYear && expMonth < currentMonth)) {
                    showToast('error', 'Tarjeta vencida', 'La fecha de expiración ya ha pasado.');
                    cardExpiryInput.focus();
                    return false;
                }
                
                // Validar CVV
                if (!/^\d{3,4}$/.test(cardCvv)) {
                    showToast('error', 'CVV inválido', 'El código CVV debe tener 3 o 4 dígitos.');
                    cardCvvInput.focus();
                    return false;
                }
                
                // Validar PIN
                if (!/^\d{4}$/.test(cardPin)) {
                    showToast('error', 'PIN inválido', 'El código PIN debe tener 4 dígitos.');
                    cardPinInput.focus();
                    return false;
                }
                
                return true;
            }

            // Función para procesar el pago
            function processPayment() {
                // Validar información de tarjeta si es el método seleccionado
                const selectedPaymentMethod = document.querySelector('.payment-option.selected').getAttribute('data-payment');
                
                if (selectedPaymentMethod === 'credit-card' && !validateCardInfo()) {
                    return;
                }
                
                // Verificar que el carrito no esté vacío
                if (cart.length === 0) {
                    showToast('error', 'Carrito vacío', 'No hay productos en tu carrito para procesar el pago.');
                    return;
                }
                
                // Mostrar overlay de carga
                loadingOverlay.classList.add('active');
                
                // Generar número de orden aleatorio
                orderNumber = generateOrderNumber();
                document.getElementById('order-number').textContent = orderNumber;
                
                // Preparar mensaje de WhatsApp con detalles completos
                let whatsappMessage = `Hola, acabo de realizar una compra en LatinPhone.\n\n`;
                whatsappMessage += `Número de orden: ${orderNumber}\n`;
                whatsappMessage += `Fecha: ${document.getElementById('order-date').textContent}\n\n`;
                whatsappMessage += `*Detalles de la compra:*\n`;
                
                // Añadir productos
                cart.forEach(item => {
                    whatsappMessage += `• ${item.quantity}x ${item.name} - $${(item.price * item.quantity).toFixed(2)}\n`;
                });
                
                // Añadir regalo si existe
                if (selectedGift) {
                    whatsappMessage += `• 1x ${selectedGift.name} (Regalo GRATIS)\n`;
                }
                
                // Añadir resumen
                const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
                const tax = subtotal * taxRate;
                const total = subtotal + tax + selectedShipping.price + selectedInsurance.price;
                
                whatsappMessage += `\n*Resumen:*\n`;
                whatsappMessage += `Subtotal: $${subtotal.toFixed(2)}\n`;
                whatsappMessage += `IVA (16%): $${tax.toFixed(2)}\n`;
                whatsappMessage += `Envío (${document.getElementById('shipping-method').textContent}): $${selectedShipping.price.toFixed(2)}\n`;
                whatsappMessage += `Seguro: $${selectedInsurance.price.toFixed(2)}\n`;
                whatsappMessage += `*Total USD: $${total.toFixed(2)}*\n`;
                whatsappMessage += `*Total Bs: ${(total * exchangeRate).toFixed(2)} Bs*\n\n`;
                
                // Añadir info de nacionalización
                const nationalizationFeeValue = calculateNationalizationFee(total);
                whatsappMessage += `*Tasa de nacionalización: ${nationalizationFeeValue.toFixed(2)} Bs*\n\n`;
                
                whatsappMessage += `Método de pago: ${document.querySelector('.payment-option.selected').querySelector('.payment-option-text').textContent}\n`;
                whatsappMessage += `Empresa de transporte: ${selectedShippingCompany.toUpperCase()}\n\n`;
                
                whatsappMessage += `Por favor, necesito finalizar el proceso de compra y confirmar los detalles de envío.`;
                
                // Configurar enlaces de WhatsApp
                const encodedMessage = encodeURIComponent(whatsappMessage);
                const whatsappUrl = `https://wa.me/+18133584564?text=${encodedMessage}`;
                whatsappBtn.href = whatsappUrl;
                whatsappSupport.href = whatsappUrl;
                
                // Simulamos el procesamiento del pago con un timeout
                setTimeout(() => {
                    loadingOverlay.classList.remove('active');
                    
                    // Mostrar el overlay de nacionalización
                    nationalizationOverlay.classList.add('active');
                    
                }, 3000); // 3 segundos de "procesamiento"
            }

            // Función para continuar después del overlay de nacionalización
            function continueAfterNationalization() {
                nationalizationOverlay.classList.remove('active');
                
                // Pago exitoso, avanzar a la confirmación
                goToStep(4);
                
                // Actualizar información de entrega
                updateDeliveryDates();
                
                // Mostrar confeti para celebrar
                if (window.confetti) {
                    confetti({
                        particleCount: 150,
                        spread: 70,
                        origin: { y: 0.6 }
                    });
                }
                
                // Generar código de promoción aleatorio
                generatePromoCode();
                
                // Notificar al usuario
                showToast('success', '¡Compra exitosa!', 'Tu pago ha sido procesado correctamente.', 8000);
            }

            // Función para actualizar las fechas de entrega
            function updateDeliveryDates() {
                const today = new Date();
                let startDate, endDate;
                
                // Ajustar fechas según el método de envío seleccionado
                switch (selectedShipping.method) {
                    case 'express':
                        startDate = new Date(today);
                        startDate.setDate(today.getDate() + 1);
                        endDate = new Date(today);
                        endDate.setDate(today.getDate() + 4);
                        break;
                    case 'standard':
                        startDate = new Date(today);
                        startDate.setDate(today.getDate() + 1);
                        endDate = new Date(today);
                        endDate.setDate(today.getDate() + 10);
                        break;
                    case 'free':
                        startDate = new Date(today);
                        startDate.setDate(today.getDate() + 15);
                        endDate = new Date(today);
                        endDate.setDate(today.getDate() + 20);
                        break;
                }
                
                // Formatear fechas
                const formatDate = (date) => {
                    return `${date.getDate().toString().padStart(2, '0')}/${(date.getMonth() + 1).toString().padStart(2, '0')}/${date.getFullYear()}`;
                };
                
                // Actualizar en la interfaz
                deliveryDateStart.textContent = formatDate(startDate);
                deliveryDateStart2.textContent = formatDate(startDate);
                deliveryDateEnd.textContent = formatDate(endDate);
                
                // Actualizar método de envío y empresa en el resumen
                let shippingMethodText = '';
                switch (selectedShipping.method) {
                    case 'express':
                        shippingMethodText = 'Express (1-4 días)';
                        break;
                    case 'standard':
                        shippingMethodText = 'Estándar (1-10 días)';
                        break;
                    case 'free':
                        shippingMethodText = 'Gratuito (15-20 días)';
                        break;
                }
                
                shippingMethod.textContent = shippingMethodText;
                shippingCompanyElement.textContent = selectedShippingCompany.toUpperCase();
            }

            // Función para generar un código de promoción
            function generatePromoCode() {
                const characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
                let code = 'LATIN';
                
                for (let i = 0; i < 3; i++) {
                    code += characters.charAt(Math.floor(Math.random() * characters.length));
                }
                
                promoCodeElement.textContent = code;
            }

            // Formatear entrada de número de tarjeta
            cardNumberInput.addEventListener('input', function(e) {
                let value = e.target.value.replace(/\D/g, '');
                let formattedValue = '';
                
                for (let i = 0; i < value.length; i++) {
                    if (i > 0 && i % 4 === 0) {
                        formattedValue += ' ';
                    }
                    formattedValue += value[i];
                }
                
                e.target.value = formattedValue.substring(0, 19); // Limitar a 19 caracteres (16 dígitos + 3 espacios)
            });

            // Formatear entrada de fecha de expiración
            cardExpiryInput.addEventListener('input', function(e) {
                let value = e.target.value.replace(/\D/g, '');
                let formattedValue = '';
                
                if (value.length > 0) {
                    // Limitar el mes a valores válidos (01-12)
                    if (value.length >= 2) {
                        const month = parseInt(value.substring(0, 2));
                        if (month > 12) {
                            value = '12' + value.substring(2);
                        } else if (month === 0) {
                            value = '01' + value.substring(2);
                        }
                    }
                    
                    formattedValue = value.substring(0, 2);
                    if (value.length > 2) {
                        formattedValue += '/' + value.substring(2, 4);
                    }
                }
                
                e.target.value = formattedValue;
            });

            // Limitar entrada de CVV a solo números
            cardCvvInput.addEventListener('input', function(e) {
                let value = e.target.value.replace(/\D/g, '');
                e.target.value = value.substring(0, 4); // Limitar a 4 dígitos
            });

            // Limitar entrada de PIN a solo números
            cardPinInput.addEventListener('input', function(e) {
                let value = e.target.value.replace(/\D/g, '');
                e.target.value = value.substring(0, 4); // Limitar a 4 dígitos
            });

            // Eventos para el dropdown de empresas de transporte
            shippingDropdownBtn.addEventListener('click', function() {
                shippingDropdownMenu.classList.toggle('active');
            });

            // Cerrar el dropdown al hacer clic fuera
            document.addEventListener('click', function(e) {
                if (!shippingDropdownBtn.contains(e.target) && !shippingDropdownMenu.contains(e.target)) {
                    shippingDropdownMenu.classList.remove('active');
                }
            });

            // Seleccionar empresa de transporte
            shippingCompanyOptions.forEach(option => {
                option.addEventListener('click', function() {
                    // Remover selección previa
                    shippingCompanyOptions.forEach(opt => opt.classList.remove('selected'));
                    
                    // Seleccionar esta opción
                    option.classList.add('selected');
                    
                    // Actualizar empresa seleccionada
                    selectedShippingCompany = option.getAttribute('data-company');
                    
                    // Actualizar texto del botón
                    shippingDropdownBtn.querySelector('span').textContent = option.querySelector('.shipping-company-text').textContent;
                    
                    // Cerrar dropdown
                    shippingDropdownMenu.classList.remove('active');
                    
                    // Notificar al usuario
                    showToast('info', 'Transportista seleccionado', `Has elegido ${selectedShippingCompany.toUpperCase()} como empresa de transporte.`);
                });
            });

            // Agregar eventos a los botones
            // 1. Selección de país
            countryCards.forEach(card => {
                card.addEventListener('click', () => {
                    selectCountry(card.getAttribute('data-country'));
                });
            });

            // 2. Selección de categoría
            categoryCards.forEach(card => {
                card.addEventListener('click', () => {
                    selectCategory(card.getAttribute('data-category'));
                });
            });

            // 3. Botones de navegación entre pasos
            continueToShippingBtn.addEventListener('click', () => {
                if (cart.length === 0) {
                    showToast('warning', 'Carrito vacío', 'Por favor, añade al menos un producto al carrito.');
                    return;
                }
                
                goToStep(2);
                
                // Poblar productos para regalo
                populateGiftProducts();
                renderGiftProducts();
                
                // Notificar al usuario
                showToast('info', 'Elige un regalo', 'Como agradecimiento por tu compra, puedes elegir un regalo gratis.');
            });

            backToProductsBtn.addEventListener('click', () => {
                goToStep(1);
            });

            continueToPaymentBtn.addEventListener('click', () => {
                if (!acceptTaxCheckbox.checked) {
                    showToast('warning', 'Aceptar términos', 'Debes aceptar los términos de la tasa de nacionalización para continuar.');
                    return;
                }
                
                // Verificar selección de compañía de envío
                if (!document.querySelector('.shipping-company-option.selected')) {
                    showToast('warning', 'Selección incompleta', 'Por favor, selecciona una empresa de transporte.');
                    return;
                }
                
                goToStep(3);
                updatePaymentSummary();
            });

            backToShippingBtn.addEventListener('click', () => {
                goToStep(2);
            });

            processPaymentBtn.addEventListener('click', () => {
                processPayment();
            });

            // 4. Opciones de envío
            shippingOptions.forEach(option => {
                option.addEventListener('click', () => {
                    // Eliminar selección previa
                    shippingOptions.forEach(opt => opt.classList.remove('selected'));
                    
                    // Seleccionar esta opción
                    option.classList.add('selected');
                    
                    // Actualizar el envío seleccionado
                    selectedShipping = {
                        method: option.getAttribute('data-shipping'),
                        price: parseFloat(option.getAttribute('data-price'))
                    };
                    
                    // Actualizar resumen
                    updateOrderSummary();
                    
                    // Notificar al usuario
                    showToast('info', 'Envío seleccionado', `Has elegido el envío ${option.querySelector('.shipping-title').textContent.trim()}.`);
                });
            });

            // 5. Opciones de seguro
            insuranceOptions.forEach(option => {
                option.addEventListener('click', () => {
                    // Eliminar selección previa
                    insuranceOptions.forEach(opt => opt.classList.remove('selected'));
                    
                    // Seleccionar esta opción
                    option.classList.add('selected');
                    
                    // Actualizar el seguro seleccionado
                    selectedInsurance = {
                        selected: option.getAttribute('data-insurance') === 'true',
                        price: parseFloat(option.getAttribute('data-price'))
                    };
                    
                    // Actualizar resumen
                    updateOrderSummary();
                    
                    // Notificar al usuario
                    const insuranceMsg = selectedInsurance.selected ? 
                        'Has seleccionado el seguro premium para tu dispositivo.' : 
                        'Has elegido no incluir seguro para tu dispositivo.';
                    
                    showToast('info', 'Seguro actualizado', insuranceMsg);
                });
            });

            // 7. Métodos de pago
            paymentOptions.forEach(option => {
                option.addEventListener('click', () => {
                    // Eliminar selección previa
                    paymentOptions.forEach(opt => opt.classList.remove('selected'));
                    
                    // Seleccionar esta opción
                    option.classList.add('selected');
                    
                    // Notificar al usuario
                    showToast('info', 'Método de pago', `Has seleccionado ${option.getAttribute('data-payment')} como método de pago.`);
                });
            });

            // 8. Descargar factura
            downloadInvoiceBtn.addEventListener('click', () => {
                showToast('success', 'Factura descargada', 'La factura ha sido descargada correctamente.');
            });

            // 9. Cerrar el modal de video
            closeVideoBtn.addEventListener('click', closeVideoModal);
            
            // También cerrar al hacer clic fuera del contenido del video
            videoModal.addEventListener('click', function(e) {
                if (e.target === videoModal) {
                    closeVideoModal();
                }
            });

            // 10. Cerrar overlay de nacionalización
            closeNationalizationBtn.addEventListener('click', continueAfterNationalization);

            // 11. Escuchar cambios en el checkbox de aceptación de tasas
            acceptTaxCheckbox.addEventListener('change', function() {
                if (this.checked) {
                    continueToPaymentBtn.disabled = false;
                } else {
                    continueToPaymentBtn.disabled = true;
                }
            });

            // Manejar eventos de teclas para accesibilidad
            document.addEventListener('keydown', function(e) {
                // Escape cierra el modal de video
                if (e.key === 'Escape' && videoModal.classList.contains('active')) {
                    closeVideoModal();
                }
                
                // Escape cierra el overlay de nacionalización
                if (e.key === 'Escape' && nationalizationOverlay.classList.contains('active')) {
                    continueAfterNationalization();
                }
            });

            // Inicialización
            updateCart();
            
            // Seleccionar por defecto la primera empresa de transporte
            if (shippingCompanyOptions.length > 0) {
                shippingCompanyOptions[0].classList.add('selected');
                selectedShippingCompany = shippingCompanyOptions[0].getAttribute('data-company');
                shippingDropdownBtn.querySelector('span').textContent = shippingCompanyOptions[0].querySelector('.shipping-company-text').textContent;
            }
            
            // Seleccionar por defecto la opción de envío estándar
            const standardOption = document.querySelector('.shipping-option[data-shipping="standard"]');
            if (standardOption) {
                standardOption.classList.add('selected');
            }
            
            // Deshabilitar botón de continuar al pago hasta aceptar términos
            continueToPaymentBtn.disabled = true;
            
            // Mostrar un toast de bienvenida
            setTimeout(() => {
                showToast('info', '¡Bienvenido a LatinPhone!', 'Selecciona tu país para comenzar tu compra.', 8000);
            }, 1000);
        });
    </script>
</body>
</html>
